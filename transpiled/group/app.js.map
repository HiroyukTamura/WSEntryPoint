{"version":3,"sources":["../../group/app.js"],"names":["postLoad","$","progress","initialErr","dialog","dialogAddSch","dialogExclude","dialogRemoveContents","dialogEditComment","dialogConfigGroup","dialogAddFile","dialogNewDoc","dialogShareRec","dialogPositibeBtn","dialogInvite","dialogAddDocComment","clickedColor","inputVal","removeContentsKey","uploadTask","uploadingData","groupImageTask","friendJson","timeline","asyncCount","defaultApp","defaultDatabase","user","groupJson","groupNodeJson","groupKey","isModalOpen","calendar","today","moment","Calendar","selector","events","console","log","el","document","querySelector","current","date","openedDay","draw","self","window","setTimeout","openDay","prototype","drawHeader","drawMonth","header","createElement","className","title","right","createMonthBtn","addEventListener","nextMonth","left","prevMonth","appendChild","innerHTML","format","month","oldMonth","next","parentNode","removeChild","backFill","currentMonth","fowardFill","clone","dayOfWeek","day","subtract","i","drawDay","add","getWeek","week","outer","getDayClass","hasClass","name","number","classList","Object","keys","HOLIDAYS","indexOf","drawEvents","element","monthlyData","dailyData","scheduleKey","hasOwnProperty","addDot","classes","push","isSame","join","details","arrow","dayNumber","querySelectorAll","innerText","textContent","currentOpened","todaysEvents","renderEvents","style","offsetLeft","ele","currentWrapper","wrapper","eventKey","colorNum","chips","createChips","find","on","ev","toolTip","parent","chipsNum","index","clickedEventKey","scheme","makeRefScheme","ref","set","then","remove","showNotification","NTF_DELETE_SCHE","children","length","createEmptySpan","insertBefore","catch","err","ERR_MSG_OPE_FAILED","createChipAddBtn","createTooltip","drawLegend","legend","calendars","map","e","color","reduce","memo","forEach","parts","split","entry","evSpan","attr","tagName","innderText","setAttribute","direction","btn","class","html","div","span","onload","firebase","initializeApp","CONFIG","database","auth","onAuthStateChanged","userObject","hide","onLoginSuccess","setPersistence","Auth","Persistence","LOCAL","uiConfig","createFbUiConfig","credential","redirectUrl","ui","firebaseui","AuthUI","show","start","error","code","message","showOpeErrNotification","initDrawerDecoration","setDrawerProfile","showModal","dialogPolyfill","registerDialog","getGroupKey","uid","once","snapshot","onGetSnapOfGroupNode","exists","toJSON","onSnapShotVanished","showAll","DEFAULT","onGetGroupSnap","preventDefault","stopPropagation","cancel","closeDialog","addSchedule","value","schemeE","val","card","subTitle","insertEle","append","addClass","setElementAsMdl","input","photoUrl","update","groupName","reason","inputComment","DELIMITER","contentKey","contents","addOneContent","titleInput","isValid","isValidAboutNullAndDelimiter","removeClass","contInput","errSpanCont","isValidCont","key","ymd","comment","displayName","photoURL","updateObject","contentName","lastEdit","lastEditor","whose","type","JSON","stringify","keyD","ymdD","updateObjectD","fadeOut","checked","commandKey","obj","createFbCommandObj","INVITE_GROUP","eq","friends","isChecked","li","createUserLi","commentInput","errSpanComment","isValidComment","objC","ADD_DOC_COMMENT","contentsKey","newComment","commandKeyC","cardCont","createHtmlAsDocFollower","warn","onClickModalCircleI","setOnClickMenu","menus","openDialog","setOnClickGroupMemberConfigLis","isEmptyObject","isAddedFrined","friendKey","isAdded","setOnGroupImageClickLis","click","setOnGroupImageInputChange","target","files","mimeType","toLowerCase","fileName","dotPos","extension","substring","size","notification","showProgressNotification","suf","storage","child","put","Math","floor","bytesTransferred","totalBytes","state","TaskState","PAUSED","RUNNING","msg","close","errMsg","downloadURL","notify","icon","progressbar","newest_on_top","allow_dismiss","showProgressbar","delay","setLisnters","onclick","event","keyup","removeAttr","hasAttribute","setOnClickFabBtns","setFileModalListeners","dropDiv","isAdvancedUpload","onNewFileInputChange","getFileFromTranfer","trigger","recordBtn","isMine","values","file","bar","p","MaterialProgress","setProgress","prop","getFileTypeImageUrl","ym","newData","dayInWeek","currentDayEle","initUserList","initContents","userList","member","sortedKeys","dropdown","memberName","avoidNullValue","parents","userKey","updates","isSharedRecord","dataKey","isFriend","targetUserKey","ADD_FRIEND","closest","open","contentData","appendContentAsDoc","ContentAppenderForImg","ContentAppenderAsOtherFile","json","parse","eleList","comments","replace","userName","userUid","userPhotoUrl","createHtmlAsDoc","prepend","mContentData","mKey","mTmeline","commentPre","fileUrl","createHtmlAsData","img","getDownloadURL","url","errIcon","initTippyNormal","openFileIcon","toShowEle","css","ul","friendName","appendTo","URL","location","href","searchParams","get","count","liGroupKeys","tippy","updateDuration","distance","popperOptions","modifiers","preventOverflow","enabled","dynamicTitle","placement"],"mappings":"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","file":"app.js","sourcesContent":["\"use strict\";\r\n\r\nconst postLoad = $('#post_load');\r\nvar progress = $('#progress');\r\nvar initialErr = false;\r\n\r\n/////////dialog////////\r\nconst dialog = $('dialog')[0];\r\nconst dialogAddSch = $('#add-sch-cnt');\r\nconst dialogExclude = $('#dialog-img-w');\r\nconst dialogRemoveContents = $('#remove-contents');\r\nconst dialogEditComment = $('#edit-comment');\r\nconst dialogConfigGroup = $('#group-config');\r\nconst dialogAddFile = $('#add-file-modal');\r\nconst dialogNewDoc = $('#modal-new-doc');\r\nconst dialogShareRec = $('#share-rec');\r\nconst dialogPositibeBtn = $('#add-group-btn');\r\nconst dialogInvite =$('#invite-group');\r\nconst dialogAddDocComment =$('#add-doc-comment');\r\nvar clickedColor = 0;\r\nvar inputVal = null;\r\nvar removeContentsKey;//contentKey\r\nvar uploadTask;\r\nvar uploadingData;\r\nvar groupImageTask;\r\nvar friendJson;\r\n\r\nconst timeline = $('#left-pain');\r\nvar asyncCount = 0;\r\nvar defaultApp;\r\nvar defaultDatabase;\r\nvar user;\r\nvar groupJson;\r\nvar groupNodeJson;\r\nvar groupKey;\r\nvar isModalOpen = false;\r\nvar calendar;\r\n\r\n//region/////////////////EventCalendar()////////////////////\r\n!function() {\r\n\r\n    var today = moment();\r\n\r\n    function Calendar(selector, events) {\r\n        console.log(events);\r\n        this.el = document.querySelector(selector);\r\n        this.events = events;\r\n        this.current = moment().date(1);\r\n        this.openedDay = moment();\r\n        this.draw();\r\n        var current = document.querySelector('.today');\r\n        if(current) {\r\n            var self = this;\r\n            window.setTimeout(function() {\r\n                self.openDay(current);\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    Calendar.prototype.draw = function() {\r\n        //Create Header\r\n        this.drawHeader();\r\n\r\n        //Draw Month\r\n        this.drawMonth();\r\n\r\n        // this.drawLegend();\r\n    }\r\n\r\n    Calendar.prototype.drawHeader = function() {\r\n        var self = this;\r\n        if(!this.header) {\r\n            //Create the header elements\r\n            this.header = createElement('div', 'header');\r\n            this.header.className = 'header';\r\n\r\n            this.title = createElement('h1');\r\n\r\n            var right = createMonthBtn('right');\r\n            right.addEventListener('click', function() { self.nextMonth(); });\r\n\r\n            var left = createMonthBtn('left');\r\n            left.addEventListener('click', function() { self.prevMonth(); });\r\n\r\n            //Append the Elements\r\n            this.header.appendChild(left);\r\n            this.header.appendChild(this.title);\r\n            this.header.appendChild(right);\r\n            this.el.appendChild(this.header);\r\n        }\r\n\r\n        this.title.innerHTML = this.current.format('YYYY.MM');\r\n    }\r\n\r\n    Calendar.prototype.drawMonth = function() {\r\n        var self = this;\r\n\r\n        // this.events.forEach(function(ev) {\r\n        //     ev.date = self.current.clone().date(Math.random() * (29 - 1) + 1);\r\n        // });\r\n\r\n        if(this.month) {\r\n            this.oldMonth = this.month;\r\n            this.oldMonth.className = 'month out ' + (self.next ? 'next' : 'prev');\r\n            this.oldMonth.addEventListener('webkitAnimationEnd', function() {\r\n                self.oldMonth.parentNode.removeChild(self.oldMonth);\r\n                self.month = createElement('div', 'month');\r\n                self.backFill();\r\n                self.currentMonth();\r\n                self.fowardFill();\r\n                self.el.appendChild(self.month);\r\n                window.setTimeout(function() {\r\n                    self.month.className = 'month in ' + (self.next ? 'next' : 'prev');\r\n                }, 16);\r\n            });\r\n        } else {\r\n            this.month = createElement('div', 'month');\r\n            this.el.appendChild(this.month);\r\n            this.backFill();\r\n            this.currentMonth();\r\n            this.fowardFill();\r\n            this.month.className = 'month new';\r\n        }\r\n    }\r\n\r\n    Calendar.prototype.backFill = function() {\r\n        var clone = this.current.clone();\r\n        var dayOfWeek = clone.day();\r\n\r\n        if(!dayOfWeek) { return; }\r\n\r\n        clone.subtract(dayOfWeek+1, 'days');\r\n\r\n        for(var i = dayOfWeek; i > 0 ; i--) {\r\n            this.drawDay(clone.add(1, 'days'));\r\n        }\r\n    }\r\n\r\n    Calendar.prototype.fowardFill = function() {\r\n        var clone = this.current.clone().add(1, 'months').subtract(1, 'days');\r\n        var dayOfWeek = clone.day();\r\n\r\n        if(dayOfWeek === 6) { return; }\r\n\r\n        for(var i = dayOfWeek; i < 6 ; i++) {\r\n            this.drawDay(clone.add(1, 'days'));\r\n        }\r\n    }\r\n\r\n    Calendar.prototype.currentMonth = function() {\r\n        var clone = this.current.clone();\r\n\r\n        while(clone.month() === this.current.month()) {\r\n            this.drawDay(clone);\r\n            clone.add(1, 'days');\r\n        }\r\n    }\r\n\r\n    Calendar.prototype.getWeek = function(day) {\r\n        if(!this.week || day.day() === 0) {\r\n            this.week = createElement('div', 'week');\r\n            this.month.appendChild(this.week);\r\n        }\r\n    }\r\n\r\n    Calendar.prototype.drawDay = function(day) {\r\n        var self = this;\r\n        this.getWeek(day);\r\n\r\n        //Outer Day\r\n        var outer = createElement('div', this.getDayClass(day));\r\n        outer.addEventListener('click', function() {\r\n            if (!$(outer).hasClass('other'))\r\n                self.openDay(this);\r\n        });\r\n\r\n        //Day Name\r\n        var name = createElement('div', 'day-name', day.format('ddd'));\r\n\r\n        //Day Number\r\n        var number = createElement('div', 'day-number', day.format('DD'));\r\n\r\n        if(day.month() === this.current.month()) {\r\n            if(day.day() === 0){\r\n                name.classList.add(\"sunday\");\r\n                number.classList.add(\"sunday\");\r\n            }\r\n            if(Object.keys(HOLIDAYS).indexOf(day.format('YYYY-MM-DD')) !== -1) {\r\n                name.classList.add(\"holiday\");\r\n                number.classList.add(\"holiday\");\r\n            }\r\n        }\r\n\r\n        //Events\r\n        var events = createElement('div', 'day-events');\r\n        this.drawEvents(day, events);\r\n\r\n        outer.appendChild(name);\r\n        outer.appendChild(number);\r\n        outer.appendChild(events);\r\n        this.week.appendChild(outer);\r\n    }\r\n\r\n    Calendar.prototype.drawEvents = function(day, element) {\r\n        if(day.month() === this.current.month()) {\r\n\r\n            var monthlyData = this.events[day.format('YYYYMM')];\r\n            if(!monthlyData) return;\r\n\r\n            var dailyData = monthlyData[day.date()];\r\n            if(!dailyData) return;\r\n\r\n            console.log(dailyData);\r\n\r\n            for (var scheduleKey in dailyData) {\r\n                if(!dailyData.hasOwnProperty(scheduleKey))\r\n                    continue;\r\n\r\n                this.addDot(element, dailyData, scheduleKey);\r\n            }\r\n        }\r\n    }\r\n\r\n    Calendar.prototype.getDayClass = function(day) {\r\n        var classes = ['day'];\r\n        if(day.month() !== this.current.month()) {\r\n            classes.push('other');\r\n        } else if (today.isSame(day, 'day')) {\r\n            classes.push('today');\r\n        }\r\n        return classes.join(' ');\r\n    }\r\n\r\n    Calendar.prototype.openDay = function(el) {\r\n        var details, arrow;\r\n        var dayNumber = +el.querySelectorAll('.day-number')[0].innerText || +el.querySelectorAll('.day-number')[0].textContent;\r\n        var day = this.current.clone().date(dayNumber);\r\n        this.openedDay.date(dayNumber);\r\n\r\n        var currentOpened = document.querySelector('.details');\r\n\r\n        //Check to see if there is an open details box on the current row\r\n        if(currentOpened && currentOpened.parentNode === el.parentNode) {\r\n            details = currentOpened;\r\n            arrow = document.querySelector('.arrow');\r\n        } else {\r\n            //Close the open events on different week row\r\n            //currentOpened && currentOpened.parentNode.removeChild(currentOpened);\r\n            if(currentOpened) {\r\n                currentOpened.addEventListener('webkitAnimationEnd', function() {\r\n                    currentOpened.parentNode.removeChild(currentOpened);\r\n                });\r\n                currentOpened.addEventListener('oanimationend', function() {\r\n                    currentOpened.parentNode.removeChild(currentOpened);\r\n                });\r\n                currentOpened.addEventListener('msAnimationEnd', function() {\r\n                    currentOpened.parentNode.removeChild(currentOpened);\r\n                });\r\n                currentOpened.addEventListener('animationend', function() {\r\n                    currentOpened.parentNode.removeChild(currentOpened);\r\n                });\r\n                currentOpened.className = 'details out';\r\n            }\r\n\r\n            //Create the Details Container\r\n            details = createElement('div', 'details in');\r\n\r\n            //Create the arrow\r\n            var arrow = createElement('div', 'arrow');\r\n\r\n            //Create the event wrapper\r\n\r\n            details.appendChild(arrow);\r\n            el.parentNode.appendChild(details);\r\n        }\r\n\r\n        // var todaysEvents = this.events.reduce(function(memo, ev) {\r\n        //     if(ev.date.isSame(day, 'day')) {\r\n        //         memo.push(ev);\r\n        //     }\r\n        //     return memo;\r\n        // }, []);\r\n        var todaysEvents = null;\r\n        var monthlyData = this.events[day.format('YYYYMM')];\r\n        if(monthlyData) {\r\n            var dailyData = monthlyData[day.date()];\r\n            if(dailyData){\r\n                todaysEvents = dailyData;\r\n            }\r\n        }\r\n\r\n        this.renderEvents(todaysEvents, details);\r\n\r\n        arrow.style.left = el.offsetLeft - el.parentNode.offsetLeft + 27 + 'px';\r\n    }\r\n\r\n    Calendar.prototype.renderEvents = function(events, ele) {\r\n        //Remove any events in the current details element\r\n        var currentWrapper = ele.querySelector('.events');\r\n        var wrapper = createElement('div', 'events in' + (currentWrapper ? ' new' : ''));\r\n        var self = this;\r\n\r\n        if(events) {\r\n            console.log(events);\r\n            for(var eventKey in events) {\r\n                if (!events.hasOwnProperty(eventKey)) continue;\r\n                var colorNum = 'colorNum' + events[eventKey][\"colorNum\"];\r\n                var chips = this.createChips(events[eventKey][\"title\"], colorNum);\r\n                $(chips).find('i').on('click', function (ev) {\r\n                    var toolTip = $(this).parent().parent();\r\n                    var chipsNum = toolTip.index();\r\n                    var clickedEventKey = Object.keys(events)[chipsNum];\r\n                    var scheme = makeRefScheme(['calendar', groupKey, self.openedDay.format('YYYYMM'), self.openedDay.date(), clickedEventKey]);\r\n                    defaultDatabase.ref(scheme).set(null).then(function () {\r\n                        delete events[clickedEventKey];\r\n                        toolTip.remove();\r\n                        showNotification(NTF_DELETE_SCHE, 'success');\r\n                        if($('.events.in').children().length === 2){\r\n                            $(createEmptySpan()).insertBefore($('#add-schedule'));\r\n                        }\r\n                        $('#calendar [key='+ eventKey +']').remove();\r\n                    }).catch(function (err) {\r\n                        console.log('foirebase err', err);\r\n                        showNotification(ERR_MSG_OPE_FAILED, 'danger');\r\n                    });\r\n                });\r\n                wrapper.appendChild(chips);\r\n            }\r\n\r\n        } else {\r\n            wrapper.appendChild(createEmptySpan());\r\n        }\r\n\r\n        wrapper.appendChild(createChipAddBtn());\r\n        wrapper.appendChild(createTooltip());\r\n\r\n        if(currentWrapper) {\r\n            currentWrapper.className = 'events out';\r\n            currentWrapper.addEventListener('webkitAnimationEnd', function() {\r\n                currentWrapper.parentNode.removeChild(currentWrapper);\r\n                ele.appendChild(wrapper);\r\n            });\r\n            currentWrapper.addEventListener('oanimationend', function() {\r\n                currentWrapper.parentNode.removeChild(currentWrapper);\r\n                ele.appendChild(wrapper);\r\n            });\r\n            currentWrapper.addEventListener('msAnimationEnd', function() {\r\n                currentWrapper.parentNode.removeChild(currentWrapper);\r\n                ele.appendChild(wrapper);\r\n            });\r\n            currentWrapper.addEventListener('animationend', function() {\r\n                currentWrapper.parentNode.removeChild(currentWrapper);\r\n                ele.appendChild(wrapper);\r\n            });\r\n        } else {\r\n            ele.appendChild(wrapper);\r\n        }\r\n    }\r\n\r\n    Calendar.prototype.drawLegend = function() {\r\n        var legend = createElement('div', 'legend');\r\n        var calendars = this.events.map(function(e) {\r\n            return e.calendar + '|' + e.color;\r\n        }).reduce(function(memo, e) {\r\n            if(memo.indexOf(e) === -1) {\r\n                memo.push(e);\r\n            }\r\n            return memo;\r\n        }, []).forEach(function(e) {\r\n            var parts = e.split('|');\r\n            var entry = createElement('span', 'entry ' +  parts[1], parts[0]);\r\n            legend.appendChild(entry);\r\n        });\r\n        this.el.appendChild(legend);\r\n    }\r\n\r\n    Calendar.prototype.nextMonth = function() {\r\n        this.current.add(1, 'months');\r\n        this.openedDay.add(1, 'months');\r\n        this.next = true;\r\n        this.draw();\r\n    }\r\n\r\n    Calendar.prototype.prevMonth = function() {\r\n        this.current.subtract(1, 'months');\r\n        this.openedDay.subtract(1, 'months');\r\n        this.next = false;\r\n        this.draw();\r\n    }\r\n\r\n    Calendar.prototype.createChips = function (innerText, color) {\r\n        var ele = document.createElement('span');\r\n        ele.className = \"mdl-chip mdl-chip--deletable mdl-pre-upgrade \" + color;\r\n        ele.innerHTML =\r\n            '<span class=\"mdl-chip__text mdl-pre-upgrade mdl-color-text--white\">'+ innerText +'</span>'+\r\n            '<a href=\"#\" class=\"mdl-chip__action mdl-pre-upgrade\"><i class=\"material-icons\">cancel</i></a>';\r\n        return ele;\r\n    }\r\n\r\n    Calendar.prototype.addDot = function (element, dailyData, scheduleKey) {\r\n        var colorNum = \"colorNum\" + dailyData[scheduleKey]['colorNum'];\r\n        var evSpan = createElement('span', colorNum);\r\n        $(evSpan).attr('key', scheduleKey);\r\n        element.appendChild(evSpan);\r\n    };\r\n\r\n    window.Calendar = Calendar;\r\n\r\n    function createElement(tagName, className, innerText) {\r\n        var ele = document.createElement(tagName);\r\n        if(className) {\r\n            ele.className = className;\r\n        }\r\n        if(innerText) {\r\n            ele.innderText = ele.textContent = innerText;\r\n        }\r\n        return ele;\r\n    }\r\n    \r\n    function createChipAddBtn() {\r\n        var ele = document.createElement('button');\r\n        ele.className = 'mdl-button mdl-js-button mdl-button--icon mdl-pre-upgrade schedule-add';\r\n        // ele.setAttribute('title', '');\r\n        ele.setAttribute('id', 'add-schedule');\r\n        ele.innerHTML = '<i class=\"material-icons\">add_circle</i>';\r\n        return ele;\r\n    }\r\n\r\n    function createTooltip() {\r\n        var ele = document.createElement('div');\r\n        ele.className = \"mdl-tooltip mdl-pre-upgrade\";\r\n        ele.setAttribute(\"data-mdl-for\", \"add-schedule\");\r\n        ele.innerHTML = '';\r\n        return ele;\r\n    }\r\n    \r\n    function createMonthBtn(direction) {\r\n        var btn = $('<button>', {\r\n            class: \"mdl-button mdl-js-button mdl-button--icon mdl-pre-upgrade \" + direction\r\n        });\r\n        btn.html('<i class=\"fas fa-caret-'+ direction +'\"></i>');\r\n        return btn[0];\r\n    }\r\n\r\n    function createEmptySpan() {\r\n        var div = createElement('div', 'event empty');\r\n        var span = createElement('span', '', '');\r\n        div.appendChild(span);\r\n        return div;\r\n    }\r\n}();\r\n//endregion\r\n\r\nwindow.onload = function (ev) {\r\n    defaultApp = firebase.initializeApp(CONFIG);\r\n    defaultDatabase = defaultApp.database();\r\n\r\n    firebase.auth().onAuthStateChanged(function(userObject) {\r\n        if (userObject) {\r\n            console.log(\"\");\r\n            progress.hide();\r\n            user = userObject;\r\n            onLoginSuccess();\r\n        } else {\r\n            firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)\r\n                .then(function() {\r\n                    var uiConfig = createFbUiConfig(function (userObject, credential, redirectUrl) {\r\n                        console.log(userObject);\r\n                        user = userObject;\r\n                        progress.hide();\r\n                        $('#login_w').hide();\r\n                        return false;\r\n                    });\r\n\r\n                    var ui = new firebaseui.auth.AuthUI(firebase.auth());\r\n                    progress.hide();\r\n                    postLoad.hide();\r\n                    $('#login_w').show();\r\n                    ui.start('#firebaseui-auth-container', uiConfig);\r\n                }).catch(function(error) {\r\n                    console.log(error.code, error.message);\r\n                    showOpeErrNotification(defaultDatabase, -1);\r\n            });\r\n        }\r\n    });\r\n\r\n    initDrawerDecoration();\r\n};\r\n\r\nfunction onLoginSuccess() {\r\n    setDrawerProfile(user);\r\n    if (!dialog.showModal) {\r\n        dialogPolyfill.registerDialog(dialog);\r\n    }\r\n\r\n    groupKey = getGroupKey();\r\n    console.log(\"onLoginSuccess:\", user, groupKey);\r\n\r\n    defaultDatabase.ref(\"userData/\" + user.uid + \"/group\").once(\"value\").then(function (snapshot) {\r\n       onGetSnapOfGroupNode(snapshot);\r\n    });\r\n\r\n    //\r\n    defaultDatabase.ref('calendar/' + groupKey).once(\"value\").then(function (snapshot) {\r\n        if(snapshot.exists()){\r\n            calendar = new Calendar('#calendar', snapshot.toJSON());\r\n        } else {\r\n            onSnapShotVanished();\r\n        }\r\n        showAll();\r\n    });\r\n\r\n    defaultDatabase.ref('friend/'+ user.uid).once('value').then(function (snapshot) {\r\n        if (snapshot.exists()) {\r\n            friendJson = snapshot.toJSON();\r\n            delete friendJson[DEFAULT];\r\n\r\n            defaultDatabase.ref(\"group/\" + groupKey).once(\"value\").then(function (snapshot) {\r\n                onGetGroupSnap(snapshot);\r\n            });\r\n\r\n        } else {\r\n            console.log('friendJson !snapshot.exist()');\r\n            onSnapShotVanished();\r\n        }\r\n    });\r\n\r\n    //init dialog\r\n    $(dialog).find(\".close\").on(\"click\", function (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        console.log('');\r\n        if (isModalOpen === dialogAddFile && uploadTask) {\r\n            uploadTask.cancel();\r\n            uploadingData = null;\r\n        }\r\n        closeDialog();\r\n        return false;\r\n    });\r\n\r\n    dialogPositibeBtn.on(\"click\", function (e) {\r\n        console.log(\"click\", \"add-group-btn\");\r\n        if(isModalOpen === dialogAddSch){\r\n            addSchedule();\r\n        } else if (isModalOpen === dialogRemoveContents) {\r\n\r\n            var scheme = makeRefScheme(['group', groupKey, \"contents\", removeContentsKey]);\r\n            defaultDatabase.ref(scheme).set(null).then(function (value) {\r\n                delete groupJson['contents'][removeContentsKey];\r\n                $('.card[key=\"' + removeContentsKey + '\"]').remove();\r\n                showNotification('', 'success');\r\n\r\n            }).catch(function (err) {\r\n                showOpeErrNotification(defaultDatabase);\r\n                console.log(err);\r\n            });\r\n\r\n        } else if (isModalOpen === dialogExclude){\r\n            //todo \r\n        } else if (isModalOpen === dialogEditComment) {\r\n\r\n            var schemeE = makeRefScheme(['group', groupKey, \"contents\", removeContentsKey, \"comment\"]);\r\n            var inputVal = $('#edit-comment-dialog').val();\r\n\r\n            defaultDatabase.ref(schemeE).set(inputVal).then(function () {\r\n                console.log(\"\");\r\n                var card = $('.file[key=\"'+ removeContentsKey +'\"]');\r\n                var subTitle = card.find(\".mdl-list__item-sub-title\");\r\n                if(subTitle.length !== 0){\r\n                    subTitle.html(inputVal);\r\n                } else {\r\n                    var insertEle = $('<span class=\"mdl-list__item-sub-title mdl-pre-upgrade\">'+ inputVal +'</span>');\r\n                    card.find('.mdl-list__item-primary-content').append(insertEle);\r\n                    card.find('.mdl-list__item').addClass('mdl-list__item--two-line');\r\n                    // insertEle.append(card.find('.mdl-list__item-primary-content'));\r\n                    setElementAsMdl(insertEle);\r\n                }\r\n                groupJson['contents'][removeContentsKey]['comment'] = inputVal;\r\n\r\n            }).catch(function (err) {\r\n                showOpeErrNotification(defaultDatabase);\r\n                console.log(err);\r\n            });\r\n\r\n        } else if (isModalOpen === dialogConfigGroup) {\r\n            var input = $('#new-group-name');\r\n            if(!input.val()){\r\n                input.parent().addClass('is-invalid');\r\n                return false;\r\n            }\r\n            var photoUrl = $('#group-config img').attr('src');\r\n            defaultDatabase.ref('group/'+groupKey+\"/\").update({\r\n                photoUrl: photoUrl,\r\n                groupName: input.val()\r\n\r\n            }).then(function (value) {//todo \r\n\r\n                showNotification('', 'success');\r\n\r\n            }).catch(function (reason) {\r\n                console.log(reason);\r\n                showOpeErrNotification(defaultDatabase);\r\n            });\r\n\r\n        } else if (isModalOpen === dialogAddFile) {\r\n            console.log('ok');\r\n            var inputComment =$('#new-file-comment');\r\n            if (inputComment.val().indexOf(DELIMITER) !== -1) {\r\n                inputComment.parent().addClass('is-invalid');\r\n                return;\r\n            } else if (!$('.drop-space').hasClass('is-uploaded') || !uploadingData) {\r\n                console.log('is-uploaded');\r\n                showNotification('', 'warning');\r\n                return;\r\n            }\r\n\r\n            uploadingData['comment'] = inputComment.val();\r\n            defaultDatabase.ref('group/'+ groupKey +'/contents/'+ uploadingData.contentKey).update(uploadingData).then(function (value) {\r\n\r\n                showNotification('', 'success');\r\n                if (!groupJson.contents)\r\n                    groupJson.contents = {};\r\n                groupJson.contents[uploadingData.contentKey] = uploadingData;\r\n                addOneContent(uploadingData.contentKey);\r\n\r\n                uploadingData = null;\r\n\r\n            }).catch(function (error) {\r\n                console.log(error.code, error.message);\r\n                showOpeErrNotification(defaultDatabase);\r\n                uploadingData = null;\r\n            });\r\n\r\n        } else if (isModalOpen === dialogNewDoc) {\r\n            var titleInput =$('#new-doc-title');\r\n            var span = titleInput.parent().find('.mdl-textfield__error');\r\n            var isValid = isValidAboutNullAndDelimiter(titleInput, span);\r\n            if (!isValid) {\r\n                titleInput.removeClass('is-invalid').removeClass('wrong-val');\r\n                return false;\r\n            }\r\n\r\n            var contInput = $('#new-doc-cont');\r\n            var errSpanCont = contInput.parent().find('.mdl-textfield__error');\r\n            var isValidCont = isValidAboutNullAndDelimiter(contInput, errSpanCont);\r\n            if (!isValidCont) {\r\n                contInput.removeClass('is-invalid').removeClass('wrong-val');\r\n                return false;\r\n            }\r\n\r\n            var key = defaultDatabase.ref('keyPusher').push().key;\r\n            var ymd = moment().format('YYYYMMDD');\r\n            var comment = {\r\n                \"title\": titleInput.val(),\r\n                \"eleList\": [\r\n                    {\r\n                        \"content\": contInput.val(),\r\n                        \"lastEdit\": ymd,\r\n                        \"user\": {\r\n                            \"isChecked\": false,\r\n                            \"name\": user.displayName,\r\n                            \"photoUrl\": user.photoURL,\r\n                            \"userUid\": user.uid\r\n                        }\r\n                    }\r\n                ]\r\n            };\r\n            var updateObject ={\r\n                contentKey: key,\r\n                contentName: titleInput.val(),\r\n                lastEdit: ymd,\r\n                lastEditor: user.uid,\r\n                whose: user.uid,\r\n                type: 'document',\r\n                comment: JSON.stringify(comment)\r\n            };\r\n            defaultDatabase.ref('group/'+ groupKey +'/contents/'+ key).set(updateObject).then(function (value) {\r\n\r\n                groupJson.contents[updateObject.contentKey] = updateObject;\r\n                showNotification('', 'success');\r\n                addOneContent(updateObject.contentKey);\r\n\r\n            }).catch(function (error) {\r\n                console.log(error.code, error.message);\r\n                showOpeErrNotification(defaultDatabase);\r\n            });\r\n\r\n        } else if (isModalOpen === dialogShareRec) {\r\n            var keyD = defaultDatabase.ref('keyPusher').push().key;\r\n            var ymdD = moment().format('YYYYMMDD');\r\n            var updateObjectD ={\r\n                contentKey: keyD,\r\n                contentName: user.displayName + '',\r\n                lastEdit: ymdD,\r\n                lastEditor: user.uid,\r\n                whose: user.uid,\r\n                type: 'data'\r\n            };\r\n            defaultDatabase.ref('group/'+ groupKey +'/contents/'+ keyD).set(updateObjectD).then(function (value) {\r\n\r\n                groupJson.contents[updateObjectD.contentKey] = updateObjectD;\r\n                showNotification('', 'success');\r\n                $('#add-record').fadeOut();\r\n                $('#remove-my-rec').show();\r\n\r\n            }).catch(function (error) {\r\n                console.log(error.code, error.message);\r\n                showOpeErrNotification(defaultDatabase);\r\n            });\r\n\r\n        } else if (isModalOpen === dialogInvite) {\r\n\r\n            console.log('');\r\n            var checked = $('#invite-group').find('.mdl-checkbox.is-checked');\r\n            if (!checked.length){\r\n                closeDialog();\r\n                return false;\r\n            }\r\n\r\n            var commandKey = defaultDatabase.ref('keyPusher').push().key;\r\n            var obj = createFbCommandObj(INVITE_GROUP, user.uid);\r\n            obj['groupKey'] = groupKey;\r\n            var keys = [];\r\n            for (var i=0; i<checked.length; i++) {\r\n                keys.push(checked.eq(i).find('.mdl-checkbox__input').attr('id'));\r\n            }\r\n\r\n            obj['keys'] = keys.join('_');//key'_'\r\n\r\n            defaultDatabase.ref('writeTask/'+ commandKey).update(obj).then(function () {\r\n\r\n                var friends = Object.keys(friendJson);\r\n                keys.forEach(function (key) {\r\n                    showNotification('', 'success');\r\n                    groupJson['member'][key] = {\r\n                        isChecked: false,\r\n                        photoUrl: friendJson[key]['photoUrl'],\r\n                        name: friendJson[key]['name']\r\n                    };\r\n                    console.log(groupJson);\r\n\r\n                    var li = createUserLi(key, friends);\r\n                    $('#column2 .mdl-list').append(li);\r\n                });\r\n\r\n            }).catch(function (error) {\r\n                console.log(error.code, error.message);\r\n                showOpeErrNotification(defaultDatabase);\r\n            });\r\n\r\n        } else if (isModalOpen === dialogAddDocComment) {\r\n            var commentInput = dialogAddDocComment.find('.mdl-textfield__input');\r\n            var errSpanComment = commentInput.parent().find('.mdl-textfield__error');\r\n            var isValidComment = isValidAboutNullAndDelimiter(commentInput, errSpanComment);\r\n            if (!isValidComment) {\r\n                commentInput.removeClass('is-invalid').removeClass('wrong-val');\r\n                return false;\r\n            }\r\n\r\n            var objC = createFbCommandObj(ADD_DOC_COMMENT, user.uid);\r\n            objC.groupKey = groupKey;\r\n            objC.contentsKey = removeContentsKey;\r\n            objC.newComment = commentInput.val();\r\n\r\n            var commandKeyC = defaultDatabase.ref('keyPusher').push().key;\r\n            defaultDatabase.ref('writeTask/'+ commandKeyC).update(objC).then(function () {\r\n\r\n                var cardCont = createHtmlAsDocFollower(user.displayName, moment().format('YYYYMMDD'), objC.newComment, user.photoURL);\r\n                // setAsMyComment(cardCont, userUid);\r\n                cardCont.find('comment-follow').addClass('author-right');\r\n                cardCont.insertBefore($('.card.comments[key='+ removeContentsKey +'] .add-comment-prev'));\r\n\r\n                showNotification('', 'success');\r\n\r\n            }).catch(function (error) {\r\n                console.warn(error.code, error.message);\r\n                showOpeErrNotification(defaultDatabase);\r\n            });\r\n        }\r\n        closeDialog();\r\n        return false;\r\n    });\r\n\r\n    $(\".modal-circle-i\").on(\"click\", function (e){\r\n        onClickModalCircleI($(this));\r\n        return false;\r\n    });\r\n}\r\n\r\nfunction setOnClickMenu(menus) {\r\n    menus.eq(0).on('click', function (e) {\r\n        e.preventDefault();\r\n        console.log('click');\r\n        openDialog(dialogConfigGroup, groupJson.groupName);\r\n        return false;\r\n    });\r\n    menus.eq(1).on('click', function (e) {\r\n        e.preventDefault();\r\n        console.log('click');\r\n\r\n        var key = null;\r\n        if(groupJson.contents){\r\n            for(var contentKey in groupJson.contents)\r\n                if (groupJson.contents.hasOwnProperty(contentKey))\r\n                    if(groupJson['contents'][contentKey]['type'] === 'data' && groupJson['contents'][contentKey]['whose'] === user.uid) {\r\n                        key = contentKey;\r\n                        break;\r\n                    }\r\n        }\r\n\r\n        if(key) {\r\n            defaultDatabase.ref('group/'+ groupKey + '/contents/' + contentKey).set(null).then(function (value) {\r\n                delete groupJson['contents'][contentKey];\r\n                menus.eq(1).hide();\r\n                console.log(groupJson);\r\n                showNotification('');\r\n                $('#add-record').show();\r\n\r\n            }).catch(function (error) {\r\n                console.log(error.code, error.message);\r\n                showOpeErrNotification(defaultDatabase);\r\n            });\r\n        } else\r\n            showNotification(ERR_MSG_OPE_FAILED, 'danger');\r\n\r\n        return false;\r\n    });\r\n}\r\n\r\nfunction setOnClickGroupMemberConfigLis() {\r\n    $('#member_conf').on('click', function (e) {\r\n        e.preventDefault();\r\n        console.log('click');\r\n\r\n        if ($.isEmptyObject(friendJson)){\r\n            showNotification('');\r\n            return;\r\n        }\r\n\r\n        //\r\n        var isAddedFrined = false;\r\n        for(var friendKey in friendJson) {\r\n            if (!friendJson.hasOwnProperty(friendKey)) continue;\r\n\r\n            var isAdded = false;\r\n            for (var key in groupJson['member']) {\r\n                if (!groupJson['member'].hasOwnProperty(key) || key === user.uid)\r\n                    continue;\r\n                if (friendKey === key) {\r\n                    isAdded = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if(!isAdded){\r\n                isAddedFrined = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (!isAddedFrined) {\r\n            showNotification('');\r\n        } else {\r\n            openDialog(dialogInvite);\r\n        }\r\n        return false;\r\n    });\r\n}\r\n\r\nfunction setOnGroupImageClickLis() {\r\n    $('.group-icon img').on('click', function (e) {\r\n        console.log('click');\r\n        e.preventDefault();\r\n        $('#group-config input')[0].click();\r\n        return false;\r\n    });\r\n}\r\n\r\nfunction setOnGroupImageInputChange() {\r\n    $('#group-config input').on('change', function (e) {\r\n        e.preventDefault();\r\n        console.log('input change');\r\n\r\n        if(groupImageTask || !e.target.files || !e.target.files[0])\r\n            return;\r\n\r\n        var mimeType = e.target.files[0].type;\r\n        if(mimeType.toLowerCase() !== 'image/jpeg' && mimeType.toLowerCase() !== 'image/png' && mimeType.toLowerCase() !== 'image/gif') {\r\n            showNotification('JPEGPNG', 'warning');\r\n            return;\r\n        }\r\n\r\n        var fileName = e.target.files[0].name;\r\n        var dotPos = fileName.indexOf('.');\r\n        if(dotPos === -1){\r\n            showNotification('JPEGPNG', 'warning');\r\n            return;\r\n        }\r\n\r\n        var extension = fileName.substring(dotPos+1);\r\n        if (extension.toLowerCase() !== 'jpeg' && extension.toLowerCase() !== 'jpg' && extension.toLowerCase() !== 'png') {\r\n            showNotification('JPEGPNG', 'warning');\r\n            return;\r\n        }\r\n\r\n        if(e.target.files[0].size > 5 * 1000 * 1000) {\r\n            showNotification('5MB', 'warning');\r\n            return;\r\n        }\r\n\r\n        var notification = showProgressNotification();\r\n\r\n        var key = defaultDatabase.ref('keyPusher').push().key;\r\n        var suf = mimeType.substring(4);//suf'/'\r\n        console.log(suf);\r\n        groupImageTask = firebase.storage().ref().child('group_icon').child(key+'.'+suf)\r\n            .put(e.target.files[0]);\r\n\r\n        groupImageTask.on('state_changed', function(snapshot){\r\n            var progress = Math.floor((snapshot.bytesTransferred / snapshot.totalBytes) * 100);\r\n            console.log('Upload is ' + progress + '% done');\r\n            switch (snapshot.state) {\r\n                case firebase.storage.TaskState.PAUSED: // or 'paused'\r\n                    console.log('Upload is paused');\r\n                    break;\r\n                case firebase.storage.TaskState.RUNNING: // or 'running'\r\n                    console.log('Upload is running');\r\n                    var msg = '<strong>'+progress+'%</strong>';\r\n                    notification.update({\r\n                        'message': msg,\r\n                        'progress': progress\r\n                    });\r\n                    break;\r\n            }\r\n        }, function (error) {\r\n            //todo \r\n            groupImageTask = null;//\r\n            notification.close();\r\n            var errMsg = ERR_MSG_OPE_FAILED;\r\n            switch (error.code){\r\n                case 'storage/retry_limit_exceeded':\r\n                    errMsg ='';\r\n                    break;\r\n                case 'storage/invalid_checksum':\r\n                    errMsg = errMsg + '';\r\n                    break;\r\n                case 'storage/canceled':\r\n                    errMsg = '';\r\n                    break;\r\n                case 'storage/cannot_slice_blob':\r\n                    errMsg = errMsg + '';\r\n                    break;\r\n                case 'storage/server_wrong_file_size':\r\n                    errMsg = errMsg + '';\r\n                    break;\r\n            }\r\n            showNotification(errMsg, 'danger');\r\n\r\n        }, function () {\r\n            var downloadURL = groupImageTask.snapshot.downloadURL;\r\n            console.log(downloadURL);\r\n            $('.group-icon img').attr('src', downloadURL);\r\n\r\n            groupImageTask = null;\r\n            notification.close();\r\n            showNotification('', 'success');\r\n        });\r\n    });\r\n}\r\n\r\nfunction showProgressNotification() {\r\n    return $.notify({\r\n        title: '...',\r\n        message: '<strong>0%</strong>',\r\n        icon: 'fas fa-cloud-upload-alt',\r\n        progressbar: 0\r\n    }, {\r\n        type: 'info',\r\n        newest_on_top: true,\r\n        allow_dismiss: false,\r\n        showProgressbar: true,\r\n        delay: 0\r\n    });\r\n}\r\n\r\nfunction setLisnters() {\r\n    window.onclick = function(event) {\r\n        // event.preventDefault();\r\n        // if (event.target == dialog && isModalOpen !== dialogConfigGroup) {\r\n        //     closeDialog();\r\n        //     return false;\r\n        // } else\r\n        if($(event.target).hasClass('schedule-add') || $(event.target).parent().hasClass('schedule-add')){\r\n            console.log(\"schedule-add\");\r\n            openDialog(dialogAddSch);\r\n            return false;\r\n        } else if ($(event.target).parent().parent().hasClass(\"modal-circle-i\")) {\r\n            return false;\r\n            onClickModalCircleI($(event.target).parent().parent());\r\n        } else if($(event.target) === $('#dummy-overlay')) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            console.log('');\r\n            return false;\r\n        } else if ($(event.target) === $('#invite-group .mdl-checkbox__ripple-container')) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            console.log('');\r\n            return false;\r\n        }\r\n        console.log($(event.target));\r\n        // return false;\r\n    };\r\n\r\n    $('#modal_input').keyup(function () {\r\n        inputVal = $(this).val();\r\n        if(inputVal && dialogPositibeBtn.attr('disabled')){\r\n            dialogPositibeBtn.removeAttr('disabled');\r\n        } else if (!inputVal && !this.hasAttribute('disabled')) {\r\n            dialogPositibeBtn.attr('disabled', '');\r\n        }\r\n    });\r\n\r\n    var menus = $('#setting-dp-ul').find('.mdl-menu__item');\r\n    setOnClickMenu(menus);\r\n    setOnClickGroupMemberConfigLis();\r\n    setOnGroupImageClickLis();\r\n    setOnGroupImageInputChange();\r\n    $('#setting-dp-ul').show();\r\n    setOnClickFabBtns();\r\n    setFileModalListeners();\r\n}\r\n\r\nfunction setFileModalListeners() {\r\n    var dropDiv = $('.drop-space');\r\n    var isAdvancedUpload = function() {\r\n        var div = document.createElement('div');\r\n        return (('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;\r\n    }();\r\n\r\n    if(isAdvancedUpload){\r\n        dropDiv.on('drag dragstart dragend dragover dragenter dragleave drop', function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n        }).on('dragover dragenter', function() {\r\n            if(!uploadingData && !uploadTask)\r\n                dropDiv.addClass('is-dragover');\r\n        }).on('dragleave dragend drop', function() {\r\n            dropDiv.removeClass('is-dragover');\r\n        }).on('drop', function(e) {\r\n            if(!uploadingData && !uploadTask) {\r\n                onNewFileInputChange(getFileFromTranfer(e));\r\n            }\r\n        });\r\n    } else {\r\n        dropDiv.find('.drag-cont i, .drag-cont p').hide();//todo \r\n    }\r\n\r\n    $('.choose-file').on('click', function (e) {\r\n        console.log('click');\r\n        e.preventDefault();\r\n        $('#dummy-overlay').trigger('click');\r\n        return false;\r\n    });\r\n\r\n    $('#dummy-overlay').on('change', function (e) {\r\n        console.log('input change');\r\n        onNewFileInputChange(getFileFromTranfer(e));\r\n        return false;\r\n    });\r\n}\r\n\r\nfunction setOnClickFabBtns() {\r\n    $('.overlay-fab').show();\r\n\r\n    $('#overlay').on('click', function (e) {\r\n        console.log('add-contents');\r\n        openDialog(dialogAddFile);\r\n        return false;\r\n    });\r\n\r\n    $('#add-doc').on('click', function (e) {\r\n        openDialog(dialogNewDoc);\r\n        return false;\r\n    });\r\n\r\n    var recordBtn = $('#add-record').on('click', function (e) {\r\n        openDialog(dialogShareRec);\r\n        return false;\r\n    });\r\n\r\n    var isMine = false;\r\n    if (groupJson.contents) {\r\n        var contents = Object.values(groupJson.contents);\r\n        for(var i=0; i<contents.length; i++) {\r\n            if(contents[i]['type'] === 'data' && contents[i]['whose'] === user.uid){\r\n                isMine = true;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (isMine)\r\n        recordBtn.hide();\r\n    else {\r\n        console.log('');\r\n        $('#setting-dp-ul .mdl-menu__item').eq(1).hide();\r\n    }\r\n}\r\n\r\n/**\r\n * if(uploadTask) -> \r\n * if(uploadingData) -> \r\n */\r\nfunction onNewFileInputChange(file) {\r\n    console.log('input change', file);\r\n\r\n    if(uploadTask || !file || uploadingData)\r\n        return;\r\n\r\n    var mimeType = file.type.toLowerCase();\r\n    if(mimeType !== 'image/jpeg' && mimeType !== 'image/png' && mimeType !== 'image/gif' && mimeType !== \"text/plain\" &&\r\n        mimeType !== \"text/txt\" && mimeType !== \"text/html\" && mimeType !== \"text/css\" && mimeType !== \"text/xml\" && mimeType !== \"application/pdf\") {\r\n        console.log(mimeType);\r\n        showNotification('', 'warning');\r\n        return;\r\n    }\r\n\r\n    var fileName = file.name;\r\n    var dotPos = fileName.indexOf('.');\r\n    if(dotPos === -1){\r\n        showNotification('', 'warning');\r\n        return;\r\n    }\r\n\r\n    var extension = fileName.substring(dotPos+1);\r\n    if(extension !== 'jpeg' && extension !== 'jpg' && extension !==  'png' && extension !== 'gif' && extension !== \"txt\" &&\r\n        extension !== \"html\" && extension !== \"css\" && extension !== \"xml\" && extension !== \"pdf\") {\r\n        showNotification('', 'warning');\r\n        console.log(extension);\r\n        return;\r\n    }\r\n\r\n    if(file.size > 10 * 1000 * 1000) {\r\n        showNotification('10MB', 'warning');\r\n        return;\r\n    }\r\n\r\n    $('.drop-space').addClass('is-uploading');\r\n\r\n    // var notification = showProgressNotification();\r\n\r\n    var key = defaultDatabase.ref('keyPusher').push().key;\r\n    var suf = mimeType.substring(mimeType.indexOf('/')+1);\r\n    console.log(suf);\r\n\r\n    uploadingData = {\r\n        contentKey: key,\r\n        contentName: fileName,\r\n        type: mimeType,\r\n        whose: user.uid,\r\n        lastEditor: user.uid,\r\n        lastEdit: moment().format('YYYYMMDD')\r\n    };\r\n    uploadTask = firebase.storage().ref().child('shareFile/'+ groupKey).child(key+'.'+suf)\r\n        .put(file);\r\n\r\n    var bar = $('.progress .mdl-progress');\r\n    var p = $('.progress p');\r\n\r\n    uploadTask.on('state_changed', function(snapshot){\r\n        var progress = Math.floor((snapshot.bytesTransferred / snapshot.totalBytes) * 100);\r\n        console.log('Upload is ' + progress + '% done');\r\n        p.html(progress +'%');\r\n        switch (snapshot.state) {\r\n            case firebase.storage.TaskState.PAUSED: // or 'paused'\r\n                console.log('Upload is paused');\r\n                break;\r\n            case firebase.storage.TaskState.RUNNING: // or 'running'\r\n                console.log('Upload is running', progress);\r\n                bar[0].MaterialProgress.setProgress(progress);\r\n                break;\r\n        }\r\n    }, function (error) {\r\n        //todo \r\n        uploadTask = null;//\r\n        uploadingData = null;\r\n        var errMsg = ERR_MSG_OPE_FAILED;\r\n        switch (error.code){\r\n            case 'storage/retry_limit_exceeded':\r\n                errMsg ='';\r\n                break;\r\n            case 'storage/invalid_checksum':\r\n                errMsg = errMsg + '';\r\n                break;\r\n            case 'storage/canceled':\r\n                errMsg = '';\r\n                break;\r\n            case 'storage/cannot_slice_blob':\r\n                errMsg = errMsg + '';\r\n                break;\r\n            case 'storage/server_wrong_file_size':\r\n                errMsg = errMsg + '';\r\n                break;\r\n        }\r\n        showNotification(errMsg, 'danger');\r\n        $('.drop-space').removeClass('is-uploading');\r\n\r\n    }, function () {\r\n        var downloadURL = uploadTask.snapshot.downloadURL;\r\n        console.log(downloadURL);\r\n\r\n        $('.file-name').html(fileName);\r\n        $('.box__success img').prop('src', getFileTypeImageUrl(mimeType));\r\n\r\n        $('.drop-space').removeClass('is-uploading').addClass('is-uploaded');\r\n\r\n        uploadTask = null;\r\n        showNotification('', 'success');\r\n    });\r\n}\r\n\r\nfunction onClickModalCircleI(target) {\r\n    $(\".modal-circle-check.show\").removeClass(\"show\");\r\n    target.next().addClass(\"show\");\r\n    clickedColor = target.parent().index();\r\n    console.log(\"\");\r\n}\r\n\r\nfunction addSchedule() {\r\n    console.log(clickedColor, inputVal, calendar.openedDay.format('YYYYMMDD'));\r\n    var ym = calendar.openedDay.format('YYYYMM');\r\n    var scheme = makeRefScheme([\"calendar\", groupKey, ym, calendar.openedDay.date()]);\r\n    var eventKey = defaultDatabase.ref(scheme).push().key;\r\n    var newData = {\r\n        'colorNum' : clickedColor,\r\n        'title' : inputVal\r\n    };\r\n    defaultDatabase.ref(makeRefScheme([scheme, eventKey])).update(newData).then(function () {\r\n        if(!calendar.events[ym])\r\n            calendar.events[ym] = {};\r\n        if(!calendar.events[ym][calendar.openedDay.date()])\r\n            calendar.events[ym][calendar.openedDay.date()] = {};\r\n\r\n        calendar.events[ym][calendar.openedDay.date()][eventKey] = newData;\r\n        calendar.renderEvents(calendar.events[ym][calendar.openedDay.date()], $('#calendar .details.in')[0]);\r\n\r\n        var date = calendar.openedDay.date();\r\n        var dayInWeek = calendar.openedDay.clone().date(1).day();\r\n        var currentDayEle = $('#calendar .day').eq(date + dayInWeek -1);\r\n        calendar.addDot(currentDayEle.find('.day-events')[0], calendar.events[ym][calendar.openedDay.date()], eventKey);\r\n\r\n        console.log(calendar.events);\r\n\r\n    }).catch(function (err) {\r\n        console.log('firebase update err', err);\r\n        showOpeErrNotification(defaultDatabase);\r\n    });\r\n}\r\n\r\nfunction onGetGroupSnap(snapshot) {\r\n    if(!snapshot.exists()){\r\n        onSnapShotVanished();\r\n        console.log(\"snapShot\" + snapshot);\r\n        return;\r\n    }\r\n\r\n    groupJson = snapshot.toJSON();\r\n    console.log(groupJson);\r\n    \r\n    initUserList();\r\n    initContents();\r\n\r\n    showAll();\r\n}\r\n\r\nfunction initUserList() {\r\n    //userList\r\n    var userList = $('.card.user-list .mdl-list');\r\n    var keys = Object.keys(groupJson.member);\r\n    var sortedKeys = [];\r\n    var friends = Object.keys(friendJson);\r\n\r\n    keys.forEach(function (key) {\r\n        if(key === DEFAULT || key === user.uid)\r\n            return;\r\n        userList.append(createUserLi(key, friends));\r\n    });\r\n\r\n    $('.btn-group').dropdown();\r\n}\r\n\r\nfunction createUserLi(key, friends) {\r\n    var member = groupJson[\"member\"][key];\r\n    var memberName = avoidNullValue(member.name, '');\r\n    var photoUrl = avoidNullValue(member.photoUrl, 'img/icon.png');\r\n    var li = $(\r\n        '<li class=\"mdl-list__item mdl-pre-upgrade\" key=\"'+key+'\">'+\r\n            '<span class=\"mdl-list__item-primary-content mdl-pre-upgrade\">'+\r\n                '<img src=\"'+ photoUrl +'\" alt=\"user-image\">'+\r\n                '<span>'+ memberName +'&nbsp;&nbsp;' +\r\n                // '<span class=\"config\"><i class=\"fas fa-cog\" id='+ key +'></i></span>' +\r\n                    '<div class=\"btn-group\">'+\r\n                        '<button type=\"button\" class=\"btn btn-secondary dropdown-toggle rounded-circle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">' +\r\n                            '<i class=\"fas fa-cog\"></i>' +\r\n                        '</button>'+\r\n                        '<div class=\"dropdown-menu dropdown-menu-right\">'+\r\n                            '<button class=\"dropdown-item stop-share\" type=\"button\"></button>'+\r\n                            '<button class=\"dropdown-item reg-my-user\" type=\"button\"></button>'+\r\n                            '<button class=\"dropdown-item discourage\" type=\"button\"></button>'+\r\n                            // '<button class=\"dropdown-item cancel-inv\" type=\"button\"></button>'+\r\n                        '</div>'+\r\n                    '</div>'+\r\n                    // '</span>'+\r\n                '</span>'+\r\n            '</span>'+\r\n\r\n            '<span class=\"mdl-list__item-secondary-action\">'+\r\n                '<span class=\"mdl-chip health-rec-btn\">'+\r\n                    '<span class=\"mdl-chip__text\">&nbsp;&nbsp;<i class=\"fas fa-external-link-square-alt fa-lg\"></i></span>'+\r\n                '</span>'+\r\n            '</span>'+\r\n        '</li>'\r\n    );\r\n\r\n    //\r\n    var isAdded = groupJson[\"member\"][key]['isChecked'];\r\n    if (!isAdded)\r\n        li.find('.discourage').hide();\r\n\r\n    li.find('.discourage').on('click', function (e) {\r\n        console.log('discourage');\r\n        var li = $(this).parents('.mdl-list__item');\r\n        var userKey = li.attr('key');\r\n        var updates = {};\r\n        updates['/group/'+ groupKey +'/member/'+ userKey] = null;\r\n        updates['/userData/'+ userKey + '/group/'+ groupKey] = null;//todo \r\n\r\n        defaultDatabase.ref().update(updates).then(function () {\r\n\r\n            showNotification('', 'success');\r\n            li.remove();//todo \r\n            delete groupJson[\"member\"][userKey];\r\n            //modalfriendJson\r\n\r\n        }).catch(function (error) {\r\n            console.log(error.code, error.message);\r\n            showOpeErrNotification(defaultDatabase);\r\n        });\r\n    });\r\n\r\n    //\r\n    var isSharedRecord = false;\r\n    for(var dataKey in groupJson['contents']) {\r\n        if (!groupJson['contents'].hasOwnProperty(dataKey)) continue;\r\n\r\n        if(groupJson['contents'][dataKey]['type'] === 'data' && groupJson['contents'][dataKey]['whose'] === key) {\r\n            isSharedRecord = true;\r\n            break;\r\n        }\r\n    }\r\n    if (!isSharedRecord) {\r\n        li.find('.stop-share').hide();\r\n        li.find('.mdl-list__item-secondary-action').hide();\r\n    }\r\n\r\n    li.find('.stop-share').on('click', function (e) {\r\n        console.log('stop-share clicked');\r\n        //todo  \r\n        defaultDatabase.ref('group/'+ groupKey +'/contents/' + key).set(null).then(function () {\r\n\r\n            showNotification('', 'success');\r\n            delete  groupJson['contents'][key];\r\n            li.find('.health-rec-btn').hide();\r\n\r\n        }).catch(function (error) {\r\n            console.log(error.code, error.message);\r\n            showOpeErrNotification(defaultDatabase);\r\n        });\r\n    });\r\n\r\n    //\r\n    var isFriend = friends.indexOf(key) !== -1;\r\n    if (isFriend)\r\n        li.find('.reg-my-user').hide();\r\n\r\n    li.find('.reg-my-user').on('click', function (e) {\r\n\r\n        var commandKey = defaultDatabase.ref('keyPusher').push().key;\r\n        var targetUserKey = $(e.target).parents('.mdl-list__item').attr('key');\r\n        var obj = createFbCommandObj(ADD_FRIEND, user.uid);\r\n        obj['key'] = user.uid;\r\n        obj['targetUserKey'] = targetUserKey;\r\n        var self = $(this).closest('.mdl-list__item');\r\n\r\n        defaultDatabase.ref('writeTask/'+ commandKey).update(obj).then(function () {\r\n\r\n            showNotification('');\r\n            friendJson[targetUserKey] = {\r\n                name: groupJson['member'][targetUserKey]['name'],\r\n                photoUrl: groupJson['member'][targetUserKey]['photoUrl'],\r\n                isChecked: false\r\n            };\r\n            self.find('.reg-my-user').hide();\r\n            if (!self.find('.dropdown-item:visible').length) {\r\n                self.find('.dropdown-menu').hide();\r\n            }\r\n\r\n        }).catch(function (reason) {\r\n            console.log(reason.code, reason.message);\r\n            showOpeErrNotification(defaultDatabase);\r\n        });\r\n    });\r\n\r\n    //\r\n    if (!isAdded && !isSharedRecord && isFriend)\r\n        li.find('.dropdown-menu').hide();\r\n\r\n    //chips\r\n    if(!member.isChecked){//todo isCheckedisAdded\r\n        li.find('.health-rec-btn').removeClass('health-rec-btn').addClass('invited').find('.mdl-chip__text').html(\"\");\r\n        // li.find('.mdl-list__item-secondary-action').remove();\r\n        // li.find('div').addClass(\"mdl-badge\").addClass('mdl-pre-upgrade').attr('data-badge', \" \");\r\n        // li.attr(\"title\", \"\");\r\n    } else {\r\n        li.find(\".health-rec-btn\").on('click', function (e) {\r\n            e.preventDefault();\r\n            var key = $(this).parents('.mdl-list__item').attr('key');\r\n            console.log('clicked uid:' + key);\r\n            window.open('../analytics/index.html?key=' + key);\r\n\r\n            return false;\r\n        });\r\n    }\r\n\r\n    return li;\r\n}\r\n\r\nfunction initContents() {\r\n    if(groupJson.contents)\r\n        for (var key in groupJson.contents)\r\n            if (groupJson.contents.hasOwnProperty(key))\r\n                addOneContent(key);\r\n}\r\n\r\nfunction addOneContent(key) {\r\n    var contentData = groupJson[\"contents\"][key];\r\n    console.log(contentData);\r\n    switch (contentData.type){\r\n        case \"document\":\r\n            appendContentAsDoc(contentData, key);\r\n            break;\r\n        case \"image/jpeg\":\r\n        case \"image/png\":\r\n        case \"image/gif\":\r\n            new ContentAppenderForImg(contentData, key, timeline);\r\n            break;\r\n        case \"data\":\r\n            break;\r\n        case \"text/plain\":\r\n        case \"text/txt\":\r\n        case \"text/html\":\r\n        case \"text/css\":\r\n        case \"text/xml\":\r\n        case \"application/pdf\":\r\n            new ContentAppenderAsOtherFile(contentData, key, timeline);\r\n            break;\r\n    }\r\n}\r\n\r\n//todo  \r\nfunction appendContentAsDoc(contentData, key) {\r\n    // var userName = groupJson[\"member\"][contentData.whose][\"name\"];//todo \r\n    var json = JSON.parse(contentData.comment);\r\n    var ymd = moment(contentData.lastEdit, \"YYYYMMDD\").format(\"YYYY.MM.DD\");\r\n    var element = null;\r\n\r\n    for(var i=0; i<json.eleList.length; i++){\r\n        console.log(json[\"eleList\"][i]);\r\n        var comments = json[\"eleList\"][i][\"content\"].replace(/(?:\\r\\n|\\r|\\n)/g, DELIMITER).split(DELIMITER);\r\n        var comment = '<p>'+ comments.join('</p><p>') +'</p>';\r\n        var userName = json[\"eleList\"][i]['user']['name'];\r\n        var userUid = json[\"eleList\"][i]['user']['userUid'];\r\n        var userPhotoUrl = avoidNullValue(json[\"eleList\"][i]['user']['photoUrl'], 'img/icon.png');\r\n        if(i === 0) {\r\n            element = createHtmlAsDoc(contentData.contentName, ymd, userName, comment, userPhotoUrl);\r\n            element.attr('key', key);\r\n            element.addClass('author-right');\r\n            element.find('.comment-first').addClass('author-right');\r\n            // setAsMyComment(element, userUid);\r\n        } else {\r\n            var cardCont = createHtmlAsDocFollower(userName, ymd, comment, userPhotoUrl);\r\n            // setAsMyComment(cardCont, userUid);\r\n            if (userUid === user.uid)\r\n                cardCont.find('comment-follow').addClass('author-right');\r\n            cardCont.insertBefore(element.find('.add-comment-prev'));\r\n        }\r\n    }\r\n\r\n    element.find('.remove_btn').on('click', function (ev) {\r\n        removeContentsKey = key;\r\n        openDialog(dialogRemoveContents, contentData.contentName);\r\n        return false;\r\n    });\r\n\r\n    element.find('.add-comment .mdl-button').on('click', function (e) {\r\n        console.log('add-comment clicked');\r\n        removeContentsKey = key;\r\n        openDialog(dialogAddDocComment);\r\n        return false;\r\n    });\r\n\r\n    timeline.prepend(element);\r\n}\r\n\r\n(function() {\r\n    function ContentAppenderForImg (contentData, key, timeline) {\r\n        this.mContentData = contentData;\r\n        this.mKey = key;\r\n        this.mTmeline = timeline;\r\n\r\n        var ymd = moment(this.mContentData.lastEdit, \"YYYYMMDD\").format(\"YYYY.MM.DD\");\r\n        var userName = groupJson[\"member\"][this.mContentData.lastEditor][\"name\"];//todo \r\n        var commentPre = this.mContentData.comment;\r\n        var comment = commentPre ?\r\n            commentPre.replace(/(?:\\r\\n|\\r|\\n)/g, \"<br />\") : null;\r\n        var photoUrl = avoidNullValue(groupJson[\"member\"][this.mContentData.whose][\"photoUrl\"], 'img/icon.png');\r\n\r\n        var fileUrl = getFileTypeImageUrl(contentData.type);\r\n        // ele.find('.file-icon').attr('src', fileUrl);\r\n        console.log(\"fileUrl: \", fileUrl);\r\n        var ele = createHtmlAsData(userName + \" at \" + ymd, this.mContentData.contentName, comment, this.mKey, photoUrl, fileUrl);\r\n\r\n        if (this.mContentData === user.uid) {\r\n            ele.find('.edit-comment').on('click', function (ev) {\r\n                console.log(commentPre);\r\n                removeContentsKey = this.mKey;\r\n                dialogEditComment.find('#edit-comment-dialog').val(commentPre);\r\n                openDialog(dialogEditComment);\r\n                return false;\r\n            });\r\n        } else {\r\n            ele.find('.edit-comment').hide();\r\n        }\r\n\r\n        ele.find('.remove_btn').on('click', function (ev) {\r\n            removeContentsKey = this.mKey;\r\n            openDialog(dialogRemoveContents, contentData.contentName);\r\n            return false;\r\n        });\r\n\r\n        this.mTmeline.prepend(ele);\r\n        var img = ele.find('.show-img img');\r\n        var suf = contentData.type.substring(contentData.type.indexOf('/')+1);\r\n        console.log(suf);\r\n        firebase.storage().ref(\"shareFile\").child(groupKey).child(this.mKey + '.' + suf).getDownloadURL().then(function(url) {\r\n            // Insert url into an <img> tag to \"download\"\r\n            img.attr(\"src\", url);\r\n            img.on('click', function (ev) {\r\n                window.open(url);\r\n            });\r\n        }).catch(function(error) {\r\n            var errIcon = $(\r\n                '<span class=\"mdl-list__item-secondary-content mdl-pre-upgrade\">'+\r\n                    '<i class=\"material-icons error-icon\" title=\"\">sms_failed</i>'+\r\n                '</span>'\r\n                );\r\n\r\n            ele.find('li.mdl-list__item').append(errIcon);\r\n            ele.find('.show-img').hide();\r\n            setElementAsMdl(ele);\r\n            initTippyNormal();\r\n\r\n            // A full list of error codes is available at\r\n            // https://firebase.google.com/docs/storage/web/handle-errors\r\n            //todo \r\n            switch (error.code) {\r\n                case 'storage/object_not_found':\r\n                    // File doesn't exist\r\n                    break;\r\n\r\n                case 'storage/unauthorized':\r\n                    // User doesn't have permission to access the object\r\n                    break;\r\n\r\n                case 'storage/canceled':\r\n                    // User canceled the upload\r\n                    break;\r\n                case 'storage/unknown':\r\n                    // Unknown error occurred, inspect the server response\r\n                    break;\r\n            }\r\n\r\n            console.log(error);\r\n        });\r\n    }\r\n\r\n    window.ContentAppenderForImg = ContentAppenderForImg;\r\n})();\r\n\r\n\r\n(function () {\r\n    function ContentAppenderAsOtherFile(contentData, key, timeline) {\r\n        this.mContentData = contentData;\r\n        this.mKey = key;\r\n        this.mTmeline = timeline;\r\n\r\n        var ymd = moment(this.mContentData.lastEdit, \"YYYYMMDD\").format(\"YYYY.MM.DD\");\r\n        var userName = groupJson[\"member\"][this.mContentData.lastEditor][\"name\"];//todo \r\n        var commentPre = this.mContentData.comment;\r\n        var comment = commentPre ?\r\n            commentPre.replace(/(?:\\r\\n|\\r|\\n)/g, \"<br />\") : null;\r\n        var photoUrl = avoidNullValue(groupJson[\"member\"][this.mContentData.whose][\"photoUrl\"], 'img/icon.png');\r\n\r\n        var fileUrl = getFileTypeImageUrl(contentData.type);\r\n\r\n        var ele = createHtmlAsData(userName + \" at \" + ymd, this.mContentData.contentName, comment, key, photoUrl, fileUrl);\r\n\r\n        if (contentData.whose === user.uid) {\r\n            ele.find('.edit-comment').on('click', function (ev) {\r\n                console.log(commentPre);\r\n                removeContentsKey = key;\r\n                dialogEditComment.find('#edit-comment-dialog').val(commentPre);\r\n                openDialog(dialogEditComment);\r\n                return false;\r\n            });\r\n        } else {\r\n            ele.find('.edit-comment').hide();\r\n        }\r\n\r\n        ele.find('.show-img').hide();\r\n\r\n        this.mTmeline.prepend(ele);\r\n\r\n        firebase.storage().ref(\"shareFile/\" + groupKey +\"/\"+ this.mKey).getDownloadURL().then(function(url) {\r\n            var openFileIcon = $(\r\n                '<span class=\"mdl-list__item-secondary-content mdl-pre-upgrade\">'+\r\n                    '<span class=\"mdl-chip mdl-pre-upgrade show-file\">'+\r\n                        '<span class=\"mdl-chip__text mdl-pre-upgrade\">&nbsp;&nbsp;<i class=\"fas fa-external-link-square-alt fa-lg\"></i></span>'+\r\n                    '</span>'+\r\n                '</span>'\r\n            );\r\n            ele.find('li.mdl-list__item').append(openFileIcon);\r\n\r\n            setElementAsMdl(ele);\r\n\r\n            openFileIcon.on('click', function (ev) {\r\n                window.open(url);\r\n                return false;\r\n            });\r\n\r\n        }).catch(function(error) {\r\n            var errIcon = $(\r\n                '<span class=\"mdl-list__item-secondary-content mdl-pre-upgrade\">'+\r\n                    '<i class=\"material-icons\" title=\"\">sms_failed</i>'+\r\n                '</span>'\r\n            );\r\n\r\n            ele.find('.mdl-list__item').append(errIcon);\r\n            setElementAsMdl(ele);\r\n\r\n            // A full list of error codes is available at\r\n            // https://firebase.google.com/docs/storage/web/handle-errors\r\n            //todo \r\n            switch (error.code) {\r\n                case 'storage/object_not_found':\r\n                    // File doesn't exist\r\n                    break;\r\n\r\n                case 'storage/unauthorized':\r\n                    // User doesn't have permission to access the object\r\n                    break;\r\n\r\n                case 'storage/canceled':\r\n                    // User canceled the upload\r\n                    break;\r\n                case 'storage/unknown':\r\n                    // Unknown error occurred, inspect the server response\r\n                    break;\r\n            }\r\n\r\n            console.log(error);\r\n        });\r\n    }\r\n\r\n    window.ContentAppenderAsOtherFile = ContentAppenderAsOtherFile;\r\n})();\r\n\r\nfunction createHtmlAsData(header, title, comment, key, photoUrl, fileUrl) {\r\n    var ele =  $(\r\n        '<div class=\"card file\" key=\"'+ key +'\">'+\r\n            '<div class=\"ele_header\">'+\r\n                '<img class=\"user-icon\" src=\"'+ photoUrl +'\" alt=\"user-icon\">'+\r\n                '<span class=\"event_title\">'+ header +'</span>'+\r\n                '<div class=\"mdl-layout-spacer mdl-pre-upgrade\"></div>'+\r\n                '<button class=\"mdl-button mdl-js-button mdl-button--icon edit-comment ele_header_button mdl-pre-upgrade\" title=\"\">'+\r\n                    '<i class=\"fas fa-comment\"></i>'+\r\n                '</button>'+\r\n                '<button class=\"mdl-button mdl-js-button mdl-button--icon remove_btn ele_header_button mdl-pre-upgrade\" title=\"\">'+\r\n                    '<i class=\"fas fa-times\"></i>'+\r\n                '</button>'+\r\n                // '<button class=\"mdl-button mdl-js-button mdl-button--icon arrow_down ele_header_button mdl-pre-upgrade\">'+\r\n                //     '<i class=\"fas fa-angle-down\">'+'</i>'+\r\n                // '</button>'+\r\n                // '<button class=\"mdl-button mdl-js-button mdl-button--icon arrow_up ele_header_button mdl-pre-upgrade\">'+\r\n                //     '<i class=\"fas fa-angle-up\"></i>'+\r\n                // '</button>'+\r\n            '</div>'+\r\n\r\n            '<div class=\"flex-box file-wrapper\">'+\r\n                '<img class=\"file-icon\" src=\"'+ fileUrl +'\" alt=\"file-icon\">'+\r\n                '<ul class=\"mdl-list mdl-pre-upgrade\">'+\r\n                    '<li class=\"mdl-list__item mdl-list__item--two-line mdl-pre-upgrade\">'+\r\n                        '<span class=\"mdl-list__item-primary-content mdl-pre-upgrade\">'+\r\n                            '<span>'+ title +'</span>'+\r\n                            '<span class=\"mdl-list__item-sub-title mdl-pre-upgrade\">'+ comment +'</span>'+\r\n                        '</span>'+\r\n                        // '<span class=\"mdl-list__item-secondary-content mdl-pre-upgrade\">'+\r\n                        //     '<button id=\"hogehogeef\" class=\"mdl-button mdl-js-button mdl-button--ico mdl-pre-upgrade\">'+\r\n                        //         '<i class=\"material-icons\">more_ver</i>'+\r\n                        //     '</button>'+\r\n                        // '</span>'+\r\n                    '</li>'+\r\n                '</ul>'+\r\n            '</div>'+\r\n            '<div class=\"show-img\">'+\r\n                '<img alt=\"file-icon\">'+\r\n            '</div>'+\r\n        '</div>');\r\n\r\n    if(!comment){\r\n        ele.find('.mdl-list__item-sub-title').remove();\r\n        ele.find(\".mdl-list__item--two-line\").removeClass('mdl-list__item--two-line');\r\n    }\r\n\r\n    return ele;\r\n}\r\n\r\nfunction createHtmlAsDoc(title, ymd, whose, comment, photoUrl) {\r\n    return $(\r\n        '<div class=\"card comments\">'+\r\n            '<div class=\"ele_header\">'+\r\n                '<i class=\"fas fa-comments fa-lg ele-icon\"></i>'+\r\n                '<span class=\"event_title\">'+ title +'</span>'+\r\n                '<div class=\"mdl-layout-spacer\"></div>'+\r\n                '<button class=\"mdl-button mdl-js-button mdl-button--icon remove_btn ele_header_button mdl-pre-upgrade\" title=\"\">'+\r\n                    '<i class=\"fas fa-times\"></i>'+\r\n                '</button>'+\r\n                // '<button class=\"mdl-button mdl-js-button mdl-button--icon arrow_up ele_header_button\">'+\r\n                //     '<i class=\"fas fa-angle-up\">'+'</i>'+\r\n                // '</button>'+\r\n            '</div>'+\r\n\r\n            '<hr class=\"seem\">'+\r\n\r\n            '<div class=\"card-cont\">'+\r\n                '<div class=\"comment-first space-horizontal\">'+\r\n                    '<ul class=\"demo-list-three mdl-list\">'+\r\n                        '<li class=\"mdl-list__item mdl-list__item--two-line mdl-pre-upgrade\">'+\r\n                            '<span class=\"mdl-list__item-primary-content mdl-pre-upgrade\">'+\r\n                                '<img src=\"'+ photoUrl +'\" alt=\"userA\" class=\"mdl-list__item-icon mdl-pre-upgrade\">'+\r\n                                '<span>'+ whose +'</span>'+\r\n                                '<span class=\"mdl-list__item-sub-title mdl-pre-upgrade\">'+ ymd +'</span>'+\r\n                            '</span>'+\r\n                        '</li>'+\r\n                    '</ul>'+\r\n                '<div class=\"comment-cont\">'+ comment +'</div>'+\r\n            '</div>'+\r\n\r\n            '<hr class=\"seem add-comment-prev\">'+\r\n\r\n            '<div class=\"add-comment\">'+\r\n                '<button class=\"mdl-button mdl-js-button mdl-button--icon mdl-pre-upgrade\" title=\"\">'+\r\n                    '<i class=\"material-icons\">add_circle</i>'+\r\n                '</button>'+\r\n            '</div>'+\r\n            // '<hr class=\"seem\">'+\r\n\r\n            // '<div class=\"comment-follow\">'+\r\n            //     '<header class=\"flex-box\">'+\r\n            //         '<img src=\"img/icon.png\" alt=\"userA\" class=\"mdl-list__item-icon author-left\">'+\r\n            //         '<div>'+\r\n            //             '<p class=\"comment-author\"></p>'+\r\n            //             '<p class=\"comment-time\">2017.11.15</p>'+\r\n            //         '</div>'+\r\n            //     '</header>'+\r\n            // '<div class=\"comment-cont\">'+\r\n            //     '<p>ZG</p>'+\r\n            // '</div>'+\r\n        '</div>');\r\n}\r\n\r\nfunction createHtmlAsDocFollower(userName, ymd, comment, userPhotoUrl) {\r\n    return $(\r\n        '<div>'+\r\n            '<hr class=\"seem\">'+\r\n            '<div class=\"comment-follow\">'+\r\n            '<header class=\"flex-box\">'+\r\n                '<img src=\"'+ userPhotoUrl +'\" alt=\"userA\" class=\"mdl-list__item-icon author-left\">'+\r\n                '<div>'+\r\n                    '<p class=\"comment-author\">'+ userName +'</p>'+\r\n                    '<p class=\"comment-time\">'+ ymd +'</p>'+\r\n                '</div>'+\r\n            '</header>'+\r\n            '<div class=\"comment-cont\">'+ comment +'</div>'+\r\n        '</div>');\r\n}\r\n\r\n// function setAsMyComment(element, userUid) {\r\n//     if (userUid === user.uid) {\r\n//         element.find('.comment-first, comment-follow').addClass('author-right');\r\n//     }\r\n// }\r\n\r\nfunction closeDialog() {\r\n    dialog.close();\r\n    isModalOpen = false;\r\n}\r\n\r\n//todo \r\nfunction openDialog(toShowEle, fileName) {\r\n    if(isModalOpen)\r\n        return;\r\n\r\n    isModalOpen = toShowEle;\r\n    toShowEle.css('display', 'inline');\r\n\r\n    if(toShowEle === dialogAddSch){\r\n        dialogPositibeBtn.html('');\r\n        dialogPositibeBtn.attr('disabled', '');\r\n        // dialogExclude.hide();\r\n        // dialogRemoveContents.hide();\r\n        // dialogEditComment.hide();\r\n        // dialogConfigGroup.hide();\r\n        // dialogAddFile.hide();\r\n        // dialogNewDoc.hide();\r\n        // dialogShareRec.hide();\r\n        // dialogInvite.hide();\r\n        $('.mdl-dialog__content').children('*:not(#add-sch-cnt)').hide();\r\n        $('#modal_input').val('');\r\n\r\n    } else if (toShowEle === dialogExclude){\r\n        dialogPositibeBtn.html('');\r\n        dialogPositibeBtn.removeAttr('disabled');\r\n        $('.mdl-dialog__content').children('*:not(#dialog-img-w)').hide();\r\n        // dialogAddSch.hide();\r\n        // dialogRemoveContents.hide();\r\n        // dialogEditComment.hide();\r\n        // dialogConfigGroup.hide();\r\n        // dialogAddFile.hide();\r\n        // dialogNewDoc.hide();\r\n        // dialogShareRec.hide();\r\n        // dialogInvite.hide();\r\n\r\n    } else if (toShowEle === dialogRemoveContents){\r\n        dialogPositibeBtn.html('');\r\n        dialogPositibeBtn.removeAttr('disabled');\r\n        // dialogExclude.hide();\r\n        // dialogAddSch.hide();\r\n        // dialogEditComment.hide();\r\n        // dialogConfigGroup.hide();\r\n        // dialogAddFile.hide();\r\n        // dialogNewDoc.hide();\r\n        // dialogShareRec.hide();\r\n        // dialogInvite.hide();\r\n        $('.mdl-dialog__content').children('*:not(#remove-contents)').hide();\r\n        dialogRemoveContents.find('p').html(\"\" + fileName + \"\");\r\n\r\n    } else if (toShowEle === dialogConfigGroup) {\r\n        dialogPositibeBtn.removeAttr('disabled');\r\n        dialogPositibeBtn.html('OK');\r\n        // dialogExclude.hide();\r\n        // dialogRemoveContents.hide();\r\n        // dialogAddSch.hide();\r\n        // dialogEditComment.hide();\r\n        // dialogAddFile.hide();\r\n        // dialogNewDoc.hide();\r\n        // dialogShareRec.hide();\r\n        // dialogInvite.hide();\r\n        $('.mdl-dialog__content').children('*:not(##share-rec)').hide();\r\n        $(dialog).removeClass('modal-new-doc-m');\r\n\r\n        var input = $('#new-group-name').val(fileName);\r\n        var img = $('#group-config img');\r\n        console.log(img, img.length, groupJson.photoUrl);\r\n            img.attr('src', groupJson.photoUrl);\r\n        dialog.showModal();//label\r\n        input.parent().addClass('is-dirty').removeClass('is-invalid');\r\n        return;\r\n\r\n    } else if (toShowEle === dialogEditComment) {\r\n        dialogPositibeBtn.removeAttr('disabled');\r\n        dialogPositibeBtn.html('OK');\r\n        // dialogExclude.hide();\r\n        // dialogRemoveContents.hide();\r\n        // dialogAddSch.hide();\r\n        // dialogConfigGroup.hide();\r\n        // dialogAddFile.hide();\r\n        // dialogNewDoc.hide();\r\n        // dialogShareRec.hide();\r\n        // dialogInvite.hide();\r\n        $('.mdl-dialog__content').children('*:not(#edit-comment)').hide();\r\n\r\n    } else if (toShowEle === dialogAddFile) {\r\n        dialogPositibeBtn.removeAttr('disabled');\r\n        dialogPositibeBtn.html('OK');\r\n        // dialogExclude.hide();\r\n        // dialogRemoveContents.hide();\r\n        // dialogAddSch.hide();\r\n        // dialogEditComment.hide();\r\n        // dialogConfigGroup.hide();\r\n        // dialogNewDoc.hide();\r\n        // dialogShareRec.hide();\r\n        // dialogInvite.hide();\r\n\r\n        $('.mdl-dialog__content').children('*:not(#add-file-modal)').hide();\r\n        $('#new-file-comment').val('').parent().removeClass('is-invalid');\r\n        $('.drop-space').removeClass('is-uploading').removeClass('is-uploaded');\r\n\r\n    } else if (toShowEle === dialogNewDoc) {\r\n        dialogPositibeBtn.removeAttr('disabled');\r\n        dialogPositibeBtn.html('OK');\r\n        // dialogExclude.hide();\r\n        // dialogRemoveContents.hide();\r\n        // dialogAddSch.hide();\r\n        // dialogEditComment.hide();\r\n        // dialogAddFile.hide();\r\n        // dialogConfigGroup.hide();\r\n        // dialogShareRec.hide();\r\n        // dialogInvite.hide();\r\n        $('.mdl-dialog__content').children('*:not(#modal-new-doc)').hide();\r\n\r\n        $('#new-doc-title').val('').parent().removeClass('is-invalid').removeClass('wrong-val');\r\n        $('#new-doc-cont').val('').parent().removeClass('is-invalid').removeClass('wrong-val');\r\n\r\n    } else if (toShowEle === dialogShareRec) {\r\n        dialogPositibeBtn.removeAttr('disabled');\r\n        dialogPositibeBtn.html('OK');\r\n        $('.mdl-dialog__content').children('*:not(#share-rec)').hide();\r\n        // dialogExclude.hide();\r\n        // dialogRemoveContents.hide();\r\n        // dialogAddSch.hide();\r\n        // dialogEditComment.hide();\r\n        // dialogAddFile.hide();\r\n        // dialogConfigGroup.hide();\r\n        // dialogNewDoc.hide();\r\n        // dialogInvite.hide();\r\n\r\n    } else if (toShowEle === dialogInvite) {\r\n\r\n        var ul = $('#invite-group .mdl-list');\r\n        ul.children().remove();\r\n        console.log(friendJson);\r\n        for(var friendKey in friendJson) {\r\n            if (!friendJson.hasOwnProperty(friendKey)) continue;\r\n\r\n            var isAdded = false;\r\n            for (var key in groupJson['member']) {\r\n                if (!groupJson['member'].hasOwnProperty(key) || key === user.uid)\r\n                    continue;\r\n                if (friendKey === key) {\r\n                    isAdded = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (isAdded) continue;\r\n\r\n            var friendName = avoidNullValue(friendJson[friendKey]['name'], '');\r\n            var photoUrl = avoidNullValue(friendJson[friendKey]['photoUrl'], '../dist/img/icon.png');\r\n            $(\r\n                '<li class=\"mdl-list__item mdl-pre-upgrade\" key=\"'+ friendKey +'\">'+\r\n                    '<span class=\"mdl-list__item-primary-content mdl-pre-upgrade\">'+\r\n                        '<img src=\"'+ photoUrl +'\" class=\"mdl-list__item-avatar mdl-pre-upgrade\">'+\r\n                        '<span>'+ friendName +'</span>'+\r\n                    '</span>'+\r\n                    '<div class=\"mdl-layout-spacer\"></div>'+\r\n                    '<div class=\"mdl-list__item-secondary-action mdl-pre-upgrade\">'+\r\n                        '<label class=\"mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect mdl-pre-upgrade\" for=\"'+ friendKey +'\">'+\r\n                            '<input type=\"checkbox\" id=\"'+ friendKey +'\" class=\"mdl-checkbox__input mdl-pre-upgrade\">'+\r\n                        '</label>'+\r\n                    '</div>'+\r\n                '</li>'\r\n            ).appendTo(ul);\r\n        }\r\n\r\n        // if(ul.children().length === 0){\r\n        //     showNotification('', 'warning');\r\n        //     return;\r\n        // }\r\n\r\n        setElementAsMdl(ul);\r\n\r\n        dialogPositibeBtn.removeAttr('disabled');\r\n        dialogPositibeBtn.html('OK');\r\n        $('.mdl-dialog__content').children('*:not(#invite-group)').hide();\r\n        // dialogExclude.hide();\r\n        // dialogRemoveContents.hide();\r\n        // dialogAddSch.hide();\r\n        // dialogEditComment.hide();\r\n        // dialogAddFile.hide();\r\n        // dialogConfigGroup.hide();\r\n        // dialogNewDoc.hide();\r\n        // dialogShareRec.hide();\r\n\r\n    } else if (toShowEle === dialogAddDocComment) {\r\n        $('.mdl-dialog__content').children('*:not(#add-doc-comment)').hide();\r\n        dialogPositibeBtn.removeAttr('disabled');\r\n        dialogPositibeBtn.html('OK');\r\n    }\r\n\r\n    if(toShowEle === dialogNewDoc) {\r\n        $(dialog).addClass('modal-new-doc-m');\r\n    } else {\r\n        $(dialog).removeClass('modal-new-doc-m');\r\n    }\r\n\r\n    dialog.showModal();\r\n}\r\n\r\nfunction getGroupKey() {\r\n    var url = new URL(window.location.href);\r\n    return url.searchParams.get(\"key\");\r\n}\r\n\r\nfunction onSnapShotVanished() {\r\n    if (!initialErr)\r\n        showOpeErrNotification(defaultDatabase, -1);\r\n    initialErr = true;\r\n}\r\n\r\nfunction onGetSnapOfGroupNode(snapshot) {\r\n    if(!snapshot.exists()){\r\n        onSnapShotVanished();\r\n        console.log(\"snapShot\" + snapshot);\r\n        return;\r\n    }\r\n\r\n    groupNodeJson = snapshot.toJSON();\r\n    console.log(groupJson);\r\n    var ul = $(\"#group-dp-ul\");\r\n    var count = 0;\r\n    console.log(groupNodeJson);\r\n    var liGroupKeys = [];\r\n    Object.keys(groupNodeJson).forEach(function (key) {\r\n        if(key === DEFAULT || !groupNodeJson[key][\"added\"])//todo \r\n            return;\r\n\r\n        if(key === groupKey) {\r\n            $('.mdl-layout__header-row .mdl-layout-title').html(groupNodeJson[key]['name']);\r\n            $('.mdl-layout__header-row img').attr('src', avoidNullValue(groupNodeJson[key]['photoUrl'], 'img/icon.png'));\r\n\r\n        } else {\r\n            var li = $('<li>', {\r\n                class: \"mdl-menu__item\"\r\n            }).html(groupNodeJson[key]['name']);\r\n\r\n            li.on('click', function (ev) {\r\n                var index = $(this).index();\r\n                window.location.href = 'http://wppsc.php.xdomain.jp/public/group/index.html?key=' + liGroupKeys[index];//todo \r\n                return false;\r\n            });\r\n\r\n            li.appendTo(ul);\r\n\r\n            liGroupKeys.push(key);\r\n            count++;\r\n        }\r\n    });\r\n\r\n    if(count === 0)\r\n        $(\"#group-drp-btn\").hide();\r\n\r\n    showAll();\r\n}\r\n\r\nfunction showAll() {\r\n    console.log(\"showAll()\");\r\n    if(asyncCount !== 2){\r\n        asyncCount++;\r\n        return;\r\n    }\r\n\r\n    setLisnters();\r\n\r\n    setElementAsMdl($('body'));\r\n\r\n    tippy('.group-icon', {\r\n        updateDuration: 0,\r\n        appendTo: $('dialog')[0],\r\n        distance: 0,\r\n        popperOptions: {\r\n            modifiers: {\r\n                preventOverflow: {\r\n                    enabled: false\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    tippy('.overlay-fab', {\r\n        updateDuration: 0,\r\n        dynamicTitle: false,\r\n        distance: 10,\r\n        placement: 'left',\r\n        popperOptions: {\r\n            modifiers: {\r\n                preventOverflow: {\r\n                    enabled: false\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    initTippyNormal();\r\n\r\n    postLoad.show();\r\n}\r\n\r\nfunction initTippyNormal() {\r\n    tippy('[title]', {\r\n        updateDuration: 0,\r\n        dynamicTitle: false,\r\n        popperOptions: {\r\n            modifiers: {\r\n                preventOverflow: {\r\n                    enabled: false\r\n                }\r\n            }\r\n        }\r\n    });\r\n}"]}