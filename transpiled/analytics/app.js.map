{"version":3,"sources":["../../analytics/app.js"],"names":["defaultDatabase","masterJson","myChart","MODE_WEEK","MODE_MONTH","displayMode","loginedUser","menuMon","$","menuWeek","currentMoment","moment","bgParam","smParam","tbody","eq","find","chartWrapper","errNonData","postLoad","headerBtnEnable","progress","pageContent","query","window","onload","init","defaultApp","firebase","initializeApp","CONFIG","database","auth","onAuthStateChanged","user","console","log","onLoginSuccess","setPersistence","Auth","Persistence","LOCAL","then","uiConfig","createFbUiConfig","credential","redirectUrl","hide","ui","firebaseui","AuthUI","show","start","catch","error","code","message","showOpeErrNotification","initDrawerDecoration","setDisplayMode","mode","attr","getDaysOfWeek","now","dayOfWeek","day","add","days","i","push","format","getDaysOfMonth","startOf","end","endOf","date","location","href","slice","indexOf","showNotification","ERR_MSG_OPE_FAILED","uid","setDrawerProfile","ScheduleParser","getScheduleAsync","css","on","e","removeAttr","restUi","showData","SummeryParser","getSummeryDataAsync","ev","prototype","scheme","makeRefScheme","ref","once","snapshot","exists","specMoment","key","count","forEach","childSnap","htmlE","wodList","tr","td","rowspan","numChildren","class","html","append","appendTo","isFirstItem","schSnap","title","child","val","groupName","colorVal","tdItem","createTd","colors","parseInt","addClass","trSingle","setElementAsMdl","schemePrev","snap","snapPrev","recordCount","ratio","clonedMoment","prevMoment","regExp","RegExp","DELIMITER","spaceRow","generateTableBorder","rangeDatas","eveDatas","clone","setSchemes","self","calcRatio","setAverageTable","onGetPrevData","recordCountPrev","diffCount","symbol","ratioPrev","diffRatio","symbol2","ratioHtml","setPrevCaption","Math","floor","daysInMonth","rowCount","rangeTitle","replace","startMinTotal","endMinTotal","startMin","startTime","min2TimeVal","endMin","endTime","timeLen","roundWithDigit","abs","lenTime","dom","row1","caption","row2","space","min","hour","timeVal","row","space0","space1","specStartMin","specEndMin","diffLenTime","diffHourStart","symbolStart","valStart","diffHourEnd","symbolEnd","valEnd","symbolCount","valCount","diffHour","minute","dates","getCount","node","masterData","arr","toJSON","newArr","Object","values","value","length","displayTest","parent","next","children","remove","id","keys","timeData","setTitle","chart","data","json","JSON","parse","rangeList","entry","getTime","getTimeVal","label","name","offset","pushData","getRangeArr","colorNum","getRangeStart","getRangeEnd","arrH","eventList","time","initTabLayout2","update","firstDate","titleMonth","titleWeek","momentO","toString","month","firstKey","maximum","getMaximumFromMode","startCal","getStartCal","yAxis","getYaxis","ctx","Chart","getContext","type","labels","makeXaxis","datasets","options","responsive","maintainAspectRatio","scales","yAxes","ticks","suggestedMin","suggestedMax","reverse","stepSize","callback","index","xAxes","autoSkip","maxRotation","minRotation","display","legend","tooltips","callbacks","intersect","toolTips","tooltipItem","datasetIndex","cal","firstCal","limit","entryC","hourOfDay","showStartRadius","showEndRadius","color","radiuses","setRadius","pointRadius","pointHoverRadius","backgroundColor","pointHoverBackgroundColor","borderColor","fill","dataArr","lastIndexOf","radiusArr","arrC","n","arrD","arrE","num","digit","round","className","colspan","bgColumns","smColumns","hasOwnProperty","dataType","addNormalColumn","addBgColumn","addSmColumn","fixBgColumnSpan","addRowsToTable","dataName","valuePos","split","smVals","totalLen","smColumnVals","smColumnKeys","len","masterKeys","k","rowHead","holidayKey","holidayPos","HOLIDAYS","keyLen","td0","titleVal","setTagInCell","m","pos","vals","tdE","titleValE","span","substring","first","second","dropDownBtn","onclick","tippy","updateDuration","popperOptions","modifiers","preventOverflow","enabled","highlightColors","chipsHtml","expandText","ele","closest","txt","componentHandler","upgradeElement"],"mappings":"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KAAG,KAAG,CAApB,EAAuBA,GAAvB,EAA2B;AACvB,YAAIA,KAAKzO,MAAI,CAAb,EAAe;AACX2O,iBAAK/O,IAAL,CAAUM,IAAV;AACH,SAFD,MAEO;AACHyO,iBAAK/O,IAAL,CAAU,IAAV;AACH;AACJ;AACDlC,YAAQC,GAAR,CAAYgR,IAAZ;AACA,WAAOA,IAAP;AACH;AACD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASvI,cAAT,CAAwBwI,GAAxB,EAA6BC,KAA7B,EAAoC;AAChC,WAAOvJ,KAAKwJ,KAAL,CAAWF,MAAIC,KAAf,IAAsBA,KAA7B;AACH;;AAED;AACA;AACA;AACA;AACA;;AAEA,SAASxK,mBAAT,CAA6B0K,SAA7B,EAAwC;AACpC,QAAM1M,KAAMtG,EAAE,MAAF,EAAU;AAClByG,eAAOuM,SADW;AAElBC,iBAAS;AAFS,KAAV,CAAZ;AAIA,WAAOjT,EAAE,MAAF,EAAU2G,MAAV,CAAiBL,EAAjB,CAAP;A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","file":"app.js","sourcesContent":["\"use strict\";\n\nlet defaultDatabase;\nlet masterJson = {};\nlet myChart;\nconst MODE_WEEK = 7;\nconst MODE_MONTH = 0;\nlet displayMode;\nlet loginedUser;\nlet menuMon = $('#dpdn-month');\nlet menuWeek = $('#dpdn-week');\nlet currentMoment = moment();\nconst bgParam = $('#bg-param');\nconst smParam = $('#sm-param');\nconst tbody = $(\".chart-ave\").eq(0).find('tbody');\nconst chartWrapper = $('#chart_w');\nconst errNonData = $('.err-non-data');\n\n/*---------loading系------*/\nconst postLoad = $('#post_load');\nlet headerBtnEnable = false;//これがfalseのとき、ヘッダボタンを押しても動作させない。\nconst progress = $('#progress');\nconst pageContent = $('.page-content');\n// var innerProgress =$('.inner-progress');\nlet query;\n\n\nwindow.onload = function init() {\n\n    const defaultApp = firebase.initializeApp(CONFIG);\n    defaultDatabase = defaultApp.database();\n\n    firebase.auth().onAuthStateChanged(function(user) {\n        if (user) {\n            console.log(\"ユーザログインしてます\");\n            loginedUser = user;\n            onLoginSuccess();\n        } else {\n            firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)\n                .then(function() {\n                    const uiConfig = createFbUiConfig(function (user, credential, redirectUrl) {\n                        progress.hide();\n                        $('#login_w').hide();\n                        loginedUser = user;\n                        onLoginSuccess();\n                        return false;\n                    });\n\n                    progress.hide();\n                    postLoad.hide();\n                    const ui = new firebaseui.auth.AuthUI(firebase.auth());\n                    $('#login_w').show();\n                    ui.start('#firebaseui-auth-container', uiConfig);\n\n                }).catch(function(error) {\n                    console.log(error.code, error.message);\n                    showOpeErrNotification(defaultDatabase);\n            });\n        }\n    });\n\n    initDrawerDecoration();\n};\n\nfunction setDisplayMode(mode) {\n    switch (mode){\n        case MODE_WEEK:\n            menuWeek.attr('disabled', '');\n            break;\n        case MODE_MONTH:\n            menuMon.attr('disabled', '');\n            break;\n    }\n    displayMode = mode;\n}\n\nfunction getDaysOfWeek() {\n    const now = moment(currentMoment);\n    let dayOfWeek = now.day();\n    now.add( -dayOfWeek, 'd');\n    const days = [];\n    for(let i=0; i<7; i++){\n        days.push(now.format('YYYYMMDD'));\n        now.add(1, 'd');\n    }\n    return days;\n}\n\nfunction getDaysOfMonth() {\n    const now = moment(currentMoment);\n    const start = moment(now).startOf('month');\n    const end = now.endOf('month').date();\n    const days = [];\n    for(let i=0; i<end; i++){\n        days.push(start.format('YYYYMMDD'));\n        start.add(1, 'd');\n    }\n    return days;\n}\n\nfunction onLoginSuccess() {\n    query = window.location.href.slice(window.location.href.indexOf('?key=') + 5);\n    console.log(query);\n\n    if (window.location.href.indexOf('?key=') === -1) {\n        showNotification(ERR_MSG_OPE_FAILED, 'danger', -1);\n        return;\n    }\n\n    if (query === loginedUser.uid) {\n        console.log('ご本人でーす');\n        setDrawerProfile(loginedUser);\n        new ScheduleParser().getScheduleAsync();\n    } else {\n        $('.mdl-layout__drawer-button').css('visibility', 'hidden');\n        $('.third-card').hide();\n        console.log('他人でーす');\n    }\n\n    if(!displayMode){\n        menuWeek.on('click', function (e) {\n            if(displayMode !== MODE_WEEK && headerBtnEnable){\n                headerBtnEnable = false;\n                displayMode = MODE_WEEK;\n                $(this).attr('disabled', '');\n                menuMon.removeAttr('disabled');\n                setDisplayMode(MODE_WEEK);\n\n                pageContent.hide();\n                // innerProgress.css('display', \"inline\");\n                restUi();\n                showData(query);\n                new ScheduleParser().getScheduleAsync();\n                new SummeryParser().getSummeryDataAsync();\n            }\n            return false;\n        });\n\n        menuMon.on('click', function (e) {\n            if(displayMode !== MODE_MONTH && headerBtnEnable){\n                headerBtnEnable = false;\n                displayMode = MODE_MONTH;\n                $(this).attr('disabled', '');\n                menuWeek.removeAttr('disabled');\n                setDisplayMode(MODE_MONTH);\n\n                pageContent.hide();\n                // innerProgress.css('display', \"inline\");\n                restUi();\n                showData(query);\n                new ScheduleParser().getScheduleAsync();\n                new SummeryParser().getSummeryDataAsync();\n            }\n            return false;\n        });\n\n        $('#prev_btn').on({\"click\": function (ev) {\n            if(!headerBtnEnable)\n                return false;\n\n            switch (displayMode){\n                case MODE_WEEK:\n                    currentMoment.add(-7, 'd');\n                    break;\n                case MODE_MONTH:\n                    currentMoment.add(-1, 'M');\n                    break;\n            }\n\n            pageContent.hide();\n            // innerProgress.css('display', \"inline\");\n            restUi();\n            showData(query);\n            new ScheduleParser().getScheduleAsync();\n            new SummeryParser().getSummeryDataAsync();\n\n            return false;\n        }});\n\n        $('#next_btn').on({\"click\": function (ev) {\n            if(!headerBtnEnable)\n                return false;\n\n            switch (displayMode){\n                case MODE_WEEK:\n                    currentMoment.add(7, 'd');\n                    break;\n                case MODE_MONTH:\n                    currentMoment.add(1, 'M');\n                    break;\n            }\n\n            pageContent.css('display', 'none');\n            // innerProgress.css('display', \"inline\");\n            restUi();\n            showData(query);\n            new ScheduleParser().getScheduleAsync();\n            new SummeryParser().getSummeryDataAsync();\n\n            return false;\n        }});\n    }\n\n    setDisplayMode(MODE_MONTH);\n\n    showData(query);\n\n    new SummeryParser().getSummeryDataAsync();\n}\n\n//todo モード別\n(function () {\n\n    const tbody = $('#third-card tbody');\n\n    // var userDataSnap, scheduleSnap;\n\n    function ScheduleParser() {\n        console.log('ScheduleParser()');\n    }\n\n    ScheduleParser.prototype.getScheduleAsync = function () {\n        const scheme = makeRefScheme(['combinedCalendar', query, currentMoment.format('YYYYMM')]);\n\n        defaultDatabase.ref(scheme).once('value').then(function (snapshot) {\n            if (!snapshot.exists()) {\n                //todo スケジュールがありません\n                return;\n            }\n\n            const specMoment = moment(snapshot.key, 'YYYYMM');\n\n            let count = 1;\n            snapshot.forEach(function (childSnap) {\n                const date = childSnap.key;\n                specMoment.date(date);\n                const htmlE = date + '(' + wodList[specMoment.day()] + ')';\n                const tr = $('<tr>');\n                const td = $('<td>', {\n                    rowspan: childSnap.numChildren(),\n                    class: 'left-column'\n                }).html(htmlE);\n                tr.append(td).appendTo(tbody);\n\n                let isFirstItem = true;\n                childSnap.forEach(function (schSnap) {\n                    // $('<tr><td class=\"seem\" colspan=\"2\"></td></tr>').appendTo(tbody);\n                    const title = schSnap.child('title').val();\n                    const groupName = schSnap.child('groupName').val();\n                    const colorVal = schSnap.child('colorNum').val();\n                    const tdItem = createTd(title, groupName);\n                    tdItem.find('.mdl-list__item-primary-content').css('border-left-color', colors[parseInt(colorVal)]);\n                    if (isFirstItem) {\n                        isFirstItem = false;\n                        tr.append(tdItem);\n                        count++;\n                        if (count%2 === 1)\n                            tr.addClass('colored');\n                    } else {\n                        const trSingle = $('<tr>');\n                        if (count%2 === 1)\n                            trSingle.addClass('colored');\n                        trSingle.append(tdItem).appendTo(tbody);\n                    }\n                });\n            });\n\n            setElementAsMdl(tbody);\n        });\n    };\n\n    function createTd(title, groupName) {\n        return $('<td class=\"right-column mdl-list__item mdl-list__item--two-line mdl-pre-upgrade\">'+\n            '<span class=\"mdl-list__item-primary-content mdl-pre-upgrade \">'+\n                '<span>'+ title +'</span>'+\n                '<span class=\"mdl-list__item-sub-title mdl-pre-upgrade\">'+ groupName +'</span>'+\n            '</span>'+\n        '</td>');\n    }\n\n    window.ScheduleParser = ScheduleParser;\n}());\n\n//todo モード別\n(function () {\n\n    let scheme, schemePrev;\n    let snap, snapPrev;\n    let recordCount;\n    let ratio;\n    let clonedMoment;\n    let prevMoment;\n    const regExp = new RegExp(DELIMITER, \"g\");\n    const spaceRow = generateTableBorder(\"table-space\");\n    const rangeDatas = {};\n    const eveDatas = {};\n\n    function SummeryParser() {\n        console.log('SummeryParser()');\n        clonedMoment = currentMoment.clone();\n        prevMoment = clonedMoment.clone().add('M', -1);\n        this.setSchemes();\n    }\n\n    SummeryParser.prototype.getSummeryDataAsync = function () {\n        const self = this;\n        defaultDatabase.ref(scheme).once('value').then(function (snapshot) {\n            if (!snapshot.exists()) {\n                //todo データがありません(右上のテーブルにも)\n                errNonData.css('display', \"block\");\n                $('#table-others').hide();\n                return;\n            }\n\n            errNonData.hide();\n            $('#table-others').css('display', \"block\");\n\n            snap = snapshot;\n            recordCount = snapshot.child('recordCount').val();\n            $('#date-bg-cap').html(recordCount +'日');\n            ratio = self.calcRatio(recordCount, clonedMoment);\n            $('#ratio-bg-cap').html(ratio +'%');\n\n            self.setAverageTable();\n\n            defaultDatabase.ref(schemePrev).once('value').then(function (snapshot) {\n                snapPrev = snapshot;\n                self.onGetPrevData();\n            });\n        });\n    };\n\n    SummeryParser.prototype.setSchemes = function () {\n        scheme = makeRefScheme(['analytics', query, clonedMoment.format('YYYYMM')]);\n        schemePrev = makeRefScheme(['analytics', query, prevMoment.format('YYYYMM')]);\n    };\n\n    SummeryParser.prototype.onGetPrevData = function () {\n        if (!snapPrev.exists()) {\n            console.log('データなし onGetPrevData');\n            //todo データがありません?\n            return;\n        }\n\n        const recordCountPrev = snapPrev.child('recordCount').val();\n        const diffCount = snapPrev.child('recordCount').val() - recordCount;\n        const symbol = diffCount < 0 ? '' : '+';\n        const html = '先月より' + symbol + diffCount + '日';\n        $('#date-cap').html(html);\n\n        const ratioPrev = this.calcRatio(recordCount, prevMoment);\n        const diffRatio = ratioPrev - ratio;\n        const symbol2 = diffRatio < 0 ? '' : '+';\n        const ratioHtml = '先月より' + symbol2 + diffRatio + '%';\n        $('#ratio-cap').html(ratioHtml);\n\n        this.setPrevCaption();\n    };\n\n    SummeryParser.prototype.calcRatio = function (recordCount, moment) {\n        return Math.floor(recordCount / moment.daysInMonth() * 100);\n    };\n\n    SummeryParser.prototype.setAverageTable = function () {\n\n        let rowCount = 0;\n        snap.child('rangeEve').forEach(function (snapshot) {\n\n            const rangeTitle = snapshot.key.replace(regExp, '  <i class=\"fas fa-angle-double-right color-orange\"></i>  ');\n            const startMinTotal = snapshot.child('startMin').val();\n            const endMinTotal = snapshot.child('endMin').val();\n            const count = snapshot.child('count').val();\n\n            const startMin = Math.floor(startMinTotal / count);\n            const startTime = min2TimeVal(startMin);\n            const endMin = Math.floor(endMinTotal / count);\n            const endTime = min2TimeVal(endMin);\n            const timeLen = roundWithDigit(Math.abs(startMin - endMin) / 60, 10);\n            rangeDatas[snapshot.key] = {};\n            rangeDatas[snapshot.key]['startMin'] = startMin;\n            rangeDatas[snapshot.key]['endMin'] = endMin;\n            rangeDatas[snapshot.key]['hourLen'] = timeLen;\n            rangeDatas[snapshot.key]['count'] = count;\n            const lenTime = timeLen + \"h\";\n\n            const dom =\n                '<tr class=\"ave-digit\">' +\n                '<td></td>' +\n                '<td class=\"range-title\" rowspan=\"2\">' + rangeTitle + '</td>' +\n                '<td class=\"range-title\">' + count + '回' + '</td>' +\n                '<td class=\"ave-digit-td no-wrap\">' + startTime + '</td>' +\n                '<td class=\"ave-digit-td ave-angle no-wrap\" rowspan=\"2\">' +\n                '<i class=\"fas fa-angle-double-right fa-lg color-orange\"></i>' +\n                '</td>' +\n                '<td class=\"ave-digit-td no-wrap\">' + endTime + '</td>' +\n                '<td class=\"ave-digit-td no-wrap\">' + lenTime + '</td>' +\n                '<td></td>' +\n                '</tr>';\n\n            const row1 = $(dom);\n            // row1.find('.fa-angle-double-right').css('color', colors[0]);\n            const caption =\n                '<tr class=\"caption\">' +\n                '<td></td>' +\n                '<td class=\"no-wrap cap-count\" data-title=\"' + snapshot.key + '\"></td>' +\n                '<td class=\"no-wrap cap-start\" data-title=\"' + snapshot.key + '\"></td>' +\n                '<td class=\"no-wrap cap-end\" data-title=\"' + snapshot.key + '\"></td>' +\n                '<td class=\"no-wrap cap-length\" data-title=\"' + snapshot.key + '\"></td>' +\n                '<td></td>' +\n                '</tr>';\n            const row2 = $(caption);\n            const space = spaceRow.clone(true);\n\n            if(rowCount %2 === 1){\n                space.addClass(\"back-orange\");\n                row1.addClass(\"back-orange\");\n                row2.addClass(\"back-orange\");\n            }\n\n            tbody.append(space)\n                .append(row1)\n                .append(row2)\n                .append(space.clone(true));\n\n            rowCount++;\n        });\n\n        snap.child('timeEve').forEach(function (snapshot) {\n            const rangeTitle = snapshot.key.replace(regExp, '  <i class=\"fas fa-angle-double-right color-orange\"></i>  ');\n            const min = snapshot.child('min').val();\n            const count = snapshot.child('count').val();\n            const hour = Math.floor(min / count);\n            const timeVal = min2TimeVal(hour);\n            eveDatas[snapshot.key] = {};\n            eveDatas[snapshot.key]['min'] = min;\n            eveDatas[snapshot.key]['count'] = count;\n\n            // var average = min2HHMM(getAverage(eveList[eveKey]));\n            const row = $(\n                '<tr class=\"ave-digit\">' +\n                '<td></td>' +\n                '<td class=\"range-title\" rowspan=\"2\">' + rangeTitle + '</td>' +\n                '<td class=\"range-title\">' + count + '回' + '</td>' +\n                '<td class=\"ave-digit-td no-wrap centering\" colspan=\"4\">' + timeVal + '</td>' +\n                '<td></td>' +\n                '</tr>' +\n                '<tr class=\"caption\">' +\n                '<td></td>' +\n                '<td class=\"no-wrap cap-count\" data-title=\"' + snapshot.key + '\"></td>' +\n                '<td class=\"no-wrap centering cap-time-eve\" colspan=\"4\" data-title=\"' + snapshot.key + '\"></td>' +\n                '<td></td>' +\n                '</tr>');\n\n            const space0 = spaceRow.clone(true);\n            const space1 = spaceRow.clone(true);\n            if(rowCount %2 === 1){\n               space0.addClass(\"back-orange\");\n               space1.addClass(\"back-orange\");\n               row.addClass(\"back-orange\");\n           }\n\n           tbody.append(space0)\n               .append(row)\n               .append(space1);\n\n           rowCount++;\n        });\n    };\n\n    SummeryParser.prototype.setPrevCaption = function () {\n        snapPrev.child('rangeEve').forEach(function (snapshot) {\n\n            const startMinTotal = snapshot.child('startMin').val();\n            const endMinTotal = snapshot.child('endMin').val();\n            const count = snapshot.child('count').val();\n\n            const startMin = Math.floor(startMinTotal / count);\n            const endMin = Math.floor(endMinTotal / count);\n            const specStartMin = rangeDatas[snapshot.key]['startMin'];\n            const specEndMin = rangeDatas[snapshot.key]['endMin'];\n            const diffLenTime = roundWithDigit(roundWithDigit(Math.abs(specStartMin - specEndMin) / 60, 10) - roundWithDigit(Math.abs(startMin - endMin) / 60, 10), 10);//ここ、なぜか四捨五入した数値を足し引きすると値がおかしくなる\n            const symbol = diffLenTime < 0 ? '' : '+';\n            const val = '先月より' + symbol + diffLenTime + 'h';\n            $('.cap-length[data-title='+ snapshot.key +']').html(val);\n\n            const diffHourStart = roundWithDigit((specStartMin - startMin) / 60, 10);\n            const symbolStart = diffHourStart < 0 ? '' : '+';\n            const valStart = '先月より' + symbolStart + diffHourStart + 'h';\n            $('.cap-start[data-title='+ snapshot.key +']').html(valStart);\n\n            const diffHourEnd = roundWithDigit((specEndMin - endMin) / 60, 10);\n            const symbolEnd = diffHourEnd < 0 ? '' : '+';\n            const valEnd = '先月より' + symbolEnd + diffHourEnd + 'h';\n            $('.cap-end[data-title='+ snapshot.key +']').html(valEnd);\n\n            const diffCount = rangeDatas[snapshot.key]['count'] - count;\n            const symbolCount = diffCount < 0 ? '' : '+';\n            const valCount = '先月より' + symbolCount + diffCount + '回';\n            $('.cap-count[data-title='+ snapshot.key +']').html(valCount);\n        });\n\n        snapPrev.child('timeEve').forEach(function (snapshot) {\n            const min = snapshot.child('min').val();\n            const count = snapshot.child('count').val();\n            const hour = roundWithDigit(Math.floor(min / count), 10);\n            const diffHour = roundWithDigit(eveDatas[snapshot.key]['min'], 10) - hour;\n            const symbol = diffHour < 0 ? '' : '+';\n            const val = '先月より' + symbol + diffHour + 'h';\n            $('.cap-time-eve[data-title='+ snapshot.key +']').html(val);\n\n            const diffCount = eveDatas[snapshot.key]['count'] - count;\n            const symbolCount = diffCount < 0 ? '' : '+';\n            const valCount = '先月より' + symbolCount + diffCount + '回';\n            $('.cap-count[data-title='+ snapshot.key +']').html(valCount);\n        });\n    };\n\n    function min2TimeVal(min) {\n        // var min = Math.abs(minTotal / count);\n        if (min >= 60*24) {\n            min = min - 60*24;\n            return moment({\n                hour: Math.floor(min / 60),\n                minute: min % 60\n            }).format('HH:mm') + '(翌日)';\n        } else if (min <= 0) {\n            min = min + 60*24;\n            return moment({\n                hour: Math.floor(min / 60),\n                minute: min % 60\n            }).format('HH:mm') + '(前日)';\n        } else {\n            console.log(min % 60, Math.floor(min / 60));\n            return moment({\n                hour: Math.floor(min / 60),\n                minute: min % 60\n            }).format('HH:mm') ;\n        }\n    }\n\n    window.SummeryParser = SummeryParser;\n})();\n\nfunction showData(uid) {\n    let dates;\n    switch (displayMode){\n        case MODE_WEEK:\n            dates = getDaysOfWeek(currentMoment);\n            break;\n        case MODE_MONTH:\n            dates = getDaysOfMonth(currentMoment);\n            break;\n    }\n\n    let getCount = 0;\n    console.log(dates);\n\n    dates.forEach(function (day) {\n        const node = \"usersParam/\" + uid + \"/\" + day;\n        defaultDatabase.ref(node).once('value').then(function(snapshot) {\n            if(!snapshot.exists()){\n                masterJson[day] = null;\n            } else {\n                const masterData = [];\n                snapshot.forEach(function (arr) {\n                    arr = arr.toJSON();\n                    if(arr[\"dataType\"] === 2 || arr[\"dataType\"] === 3){\n                        const newArr = [];\n                        Object.values(arr[\"data\"]).forEach(function (value) {\n                            newArr.push(value);\n                        });\n                        arr[\"data\"] = newArr;\n                    }\n                    masterData.push(arr);\n                });\n                masterJson[day] =  masterData;\n            }\n\n            getCount++;\n\n            //最後のデータかどうかをチェック\n            if(getCount === dates.length){\n                console.log(masterJson);\n                displayTest();\n            }\n        });\n    });\n}\n\nfunction restUi() {\n    bgParam.html(\"\");\n    smParam.html(\"\");\n    bgParam.parent().next().html(\"\");\n    chartWrapper.children().remove();\n\n    $('<canvas>', {\n       id: 'chart_div'\n    }).appendTo(chartWrapper);\n    tbody.html(\"\");\n    myChart = null;\n    masterJson = {};\n}\n\nfunction displayTest() {\n    //dataType === 1のものを集計する。\n    const keys = Object.keys(masterJson);\n    const timeData = {};\n    setTitle(displayMode, keys[0]);\n    chart(displayMode, keys[0]);\n\n    let date = 0;\n    keys.forEach(function (key) {\n        if(masterJson[key]){\n            masterJson[key].forEach(function (data) {\n                if(data[\"dataType\"] === 1){\n                    const json = JSON.parse(data[\"data\"][\"0\"]);\n                    console.log(json);\n                    timeData[key] = json;\n                    // var date = moment(key, \"YYYYMMDD\").date();\n                    json.rangeList.forEach(function (entry) {\n\n                        const start = getTime(entry.start);\n                        const end = getTime(entry.end);\n                        const timeVal = getTimeVal(entry.start) + \" → \" + getTimeVal(entry.end);\n                        console.log(entry.start);\n                        const label = entry.start.name + \" → \" + entry.end.name;\n\n                        if (entry.start.offset === entry.end.offset){\n\n                            pushData(getRangeArr(date, start, end, entry.start.offset), date, entry.colorNum, label, timeVal, true, true);\n\n                        } else if (entry.end.offset - entry.start.offset === 1){\n\n                            date -= entry.start.offset;\n                            pushData(getRangeStart(date, start), date, entry.colorNum, label, timeVal, true, false);\n                            date += 1;\n                            pushData(getRangeEnd(date, end), date, entry.colorNum, label, timeVal, false, true);\n\n                        } else if (entry.end.offset - entry.start.offset === 2){\n\n                            date -= entry.start.offset;\n                            pushData(getRangeStart(date, start), date, entry.colorNum, label, timeVal, true, false);\n\n                            date += 1;\n                            const arrH = [];\n                            for(let i=0; i<=24; i++){\n                                arrH.push(date);\n                            }\n\n                            pushData(arrH, date, false, false);\n\n                            date += 1;\n                            pushData(getRangeEnd(date, start), date, entry.colorNum, label, timeVal, false, true);\n                        }\n                    });\n\n                    json.eventList.forEach(function (entry) {\n                        const time = getTime(entry);\n                        const timeVal = getTimeVal(entry);\n                        pushData(getRangeArr(date, time, time, 0), date, entry.colorNum, entry.name, timeVal);\n                    });\n                }\n            });\n        }\n\n        date++;\n    });\n\n    // showAverage(timeData);\n\n    initTabLayout2();\n    // var table = $('#table-others');\n    // var tableWidth = table.css({ position: \"absolute\", visibility: \"hidden\", display: \"block\" });\n    // table.css({ position: \"\", visibility: \"\", display: \"\" });\n    // $('.mdl-mini-footer').css('min-width', tableWidth+1);\n\n    // innerProgress.css('display', \"none\");\n    progress.hide();\n    pageContent.css('display', 'block');\n    postLoad.css('display', 'block');\n\n    myChart.update();\n\n    headerBtnEnable = true;\n}\n\nfunction setTitle(mode, firstDate) {\n    console.log(firstDate);\n    const titleMonth = $('#chart_title_w_month');\n    const titleWeek = $('#chart_title_w');\n    const momentO = moment(firstDate.toString(), \"YYYYMMDD\");\n    switch (mode){\n        case MODE_WEEK:\n            const start = momentO.format('MM.DD') + \"(\" + wodList[0] + \")\";\n            momentO.add(mode-1, 'd');\n            const end = momentO.format('MM.DD') + \"(\" + wodList[MODE_WEEK - 1] + \")\";\n            console.log(end);\n            $('#chart_title_start').html(start);\n            $('#chart_title_end').html(end);\n            titleMonth.css('display', 'none');\n            titleWeek.css('display', 'inline');\n            break;\n        case MODE_MONTH:\n            titleMonth.html((momentO.month()+1) + \"月\");\n            titleMonth.css('display', 'inline');\n            titleWeek.css('display', 'none');\n            break;\n    }\n}\n\nfunction chart(mode, firstKey) {\n    const maximum = getMaximumFromMode(mode);\n    const startCal = getStartCal(mode, firstKey);\n\n    // var dates = getDateYmds(mode, startCal, maximum);\n    const yAxis = getYaxis(mode, startCal, maximum);\n    // var fontColors = [];\n    // yAxis.forEach(function (value) {\n    //    if(value.indexOf('日')){\n    //        fontColors.push('#dd3734');\n    //    } else {\n    //        fontColors.push(null);\n    //    }\n    // });\n\n    const ctx = $('#chart_div');\n    switch (mode){\n        case MODE_MONTH:\n            chartWrapper.css('height', 1000);//todo これはこれでいいのか？\n            break;\n        case MODE_WEEK:\n            chartWrapper.removeAttr('style');\n            break;\n    }\n\n    // var keys = Object.keys(masterJson);\n    myChart = new Chart(ctx[0].getContext(\"2d\"), {\n        type: 'line',\n        data: {\n            labels: makeXaxis(),\n            datasets: []\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: mode !== MODE_MONTH,\n            scales: {\n                yAxes: [{\n                    ticks: {\n                        suggestedMin: 0,\n                        suggestedMax: maximum,\n                        reverse: true,\n                        stepSize: 1,\n                        // fontColor: fontColors,\n                        callback: function (value, index, values) {\n                            if (index === maximum)\n                                return null;\n\n                            return yAxis[value];\n                        }\n                    }\n                }],\n                xAxes: [{\n                    ticks: {\n                        callback: function(value, index, values) {\n                            if(value)\n                                return value;\n                        },\n                        autoSkip: true,\n                        maxRotation: 0,\n                        minRotation: 0\n                    },\n                    display: true\n                }]\n            },\n            legend: {\n                display: false\n            },\n            tooltips: {\n                callbacks: {\n                    intersect: false,\n                    mode: 'point',\n                    title: function (toolTips, data) {\n                        console.log(toolTips, data);\n                        return yAxis[toolTips[0][\"yLabel\"]];\n                    },\n                    label: function (tooltipItem, data) {\n                        const arr = data[\"datasets\"][tooltipItem.datasetIndex];\n                        return arr.label +\" \"+ arr.timeVal;\n                    }\n                }\n            }\n        }\n    });\n}\n\nfunction getStartCal(mode, firstKey) {\n    let cal = moment(firstKey, 'YYYYMMDD');\n    if(mode === MODE_MONTH){\n        cal = cal.startOf('month');\n        console.log(\"getStartCal\", \"こっち\");\n    }\n    return cal;\n}\n\nfunction getYaxis(mode, firstCal, maximum) {\n    const cal = moment(firstCal);\n    const yAxis = [];\n    let month = null;\n    for(let i=0; i<maximum; i++){\n        let value;\n        if(mode === MODE_WEEK && (i === 0 || cal.month() !== month)){\n            month = cal.month();\n            value = cal.format('MM/DD');\n        } else {\n            value = cal.format('DD');\n        }\n        yAxis.push(value +\"(\"+ wodList[cal.day()] +\")\");\n        cal.add(1, 'd');\n    }\n\n    return yAxis;\n}\n\nfunction getMaximumFromMode(mode) {\n    switch (mode){\n        case MODE_WEEK:\n            return 7;\n        case MODE_MONTH:\n            return currentMoment.endOf('month').date();\n    }\n}\n\n/*---------------描画まわり-------------*/\nfunction makeXaxis() {\n    const arr = [];\n    const limit = 24 * 4;\n    for (let i=0; i<=limit; i++){\n        if(i === 0) {\n            arr.push(i);\n        } else if(i%8 === 0) {\n            arr.push(i/4);\n        } else {\n            arr.push(null);\n        }\n    }\n    return arr;\n}\n\nfunction getTime(entryC) {\n    const hour = entryC.cal.hourOfDay;\n    const min = entryC.cal.minute;\n    return hour + min/60\n}\n\nfunction getTimeVal(entryC) {\n    const hour = entryC.cal.hourOfDay;\n    const min = entryC.cal.minute;\n    const time = moment();\n    time.hour(hour);\n    time.minute(min);\n    return time.format('HH:mm');\n}\n\nfunction pushData(arr, date, colorNum, label, timeVal, showStartRadius, showEndRadius) {\n    const color = colors[colorNum];\n    const radiuses = setRadius(arr, date, showStartRadius, showEndRadius);\n    myChart.data.datasets.push({\n        data: arr,\n        label: label,\n        pointRadius: radiuses,\n        pointHoverRadius: radiuses,\n        backgroundColor: color,\n        pointHoverBackgroundColor: color,\n        borderColor: color,\n        fill: false,\n        timeVal: timeVal\n    });\n}\n\nfunction setRadius(dataArr, date, showStartRadius, showEndRadius) {\n    const start = dataArr.indexOf(date);\n    const end = dataArr.lastIndexOf(date);\n    console.log(start +\", \"+ end);\n    const radiusArr = [];\n    for (let i=0; i<dataArr.length; i++){\n        if ((showStartRadius && i === start) || (showEndRadius && i === end)) {\n            radiusArr.push(5);\n        } else {\n            radiusArr.push(0);\n        }\n    }\n    return radiusArr;\n}\n\nfunction getRangeArr(date, start, end, offset) {\n    const arrC = [];\n    date = date + offset;\n    const limit = 24 * 4;\n    for(let n=0; n<=limit; n++){\n        if (start*4<=n && n<end*4+1){\n            arrC.push(date);\n        } else {\n            arrC.push(null);\n        }\n    }\n    return arrC;\n}\n\nfunction getRangeStart(date, start) {\n    const arrD = [];\n    for (let n=0; n<=24*4; n++){\n        if (start*4 < n){\n            arrD.push(date);\n        } else {\n            arrD.push(null);\n        }\n    }\n    return arrD;\n}\n\nfunction getRangeEnd(date, end) {\n    const arrE = [];\n    for (let n=0; n<=24*4; n++){\n        if (n <= end*4){\n            arrE.push(date);\n        } else {\n            arrE.push(null);\n        }\n    }\n    console.log(arrE);\n    return arrE;\n}\n/*---------------描画まわりここまで-------------*/\n\n/*---------------分析画面系ここから-------------*/\n// function showAverage(timeData) {\n//    var ranges = generateAveArr(timeData);\n//    var count = 0;\n//    for(var key in ranges){\n//        if(ranges.hasOwnProperty(key)){\n//            var aveStart = getAverage(ranges[key][\"start\"]);\n//            var aveEnd = getAverage(ranges[key][\"end\"]);\n//            var aveLen = roundWithDigit(Math.abs(aveStart - aveEnd)/60, 10) + \"h\";\n//            //DOMを挿入\n//            var dom =\n//                '<tr class=\"ave-digit\">' +\n//                    '<td class=\"range-title\" rowspan=\"2\">'+ key +'</td>' +\n//                    '<td class=\"ave-digit-td no-wrap\">'+ min2HHMM(aveStart)+'</td>' +\n//                    '<td class=\"ave-digit-td ave-angle no-wrap\" rowspan=\"2\">' +\n//                         '<i class=\"fas fa-angle-double-right fa-lg color-orange\"></i>' +\n//                    '</td>' +\n//                    '<td class=\"ave-digit-td no-wrap\">'+ min2HHMM(aveEnd) +'</td>' +\n//                    '<td class=\"ave-digit-td no-wrap\">'+ aveLen +'</td>' +\n//                '</tr>';\n//            var row1 = $(dom);\n//            row1.find('.fa-angle-double-right').css('color', colors[ranges[key]['colorNum']]);\n//            var caption =\n//                '<tr class=\"caption\">' +\n//                    '<td class=\"no-wrap\">先週より+2h15min</td>' +\n//                    '<td class=\"no-wrap\">先週より-45min</td>' +\n//                    '<td class=\"no-wrap\">先週より+2h15min</td>' +\n//                '</tr>';\n//            var row2 = $(caption);\n//            var space = generateTableBorder(\"table-space\");\n//            if(count %2 === 1){\n//                space.addClass(\"back-orange\");\n//                row1.addClass(\"back-orange\");\n//                row2.addClass(\"back-orange\");\n//                // row1.find('i').addClass(\"color-orange\");\n//            // } else {\n//            //     row1.find('i').addClass(\"color-disable\");\n//            }\n//            // var seem = generateTableBorder(\"table-seem\");\n//            tbody.append(space)\n//                .append(row1)\n//                .append(row2)\n//                .append(space.clone(true));\n//\n//            count++;\n//        }\n//    }\n//\n//    var eveList = generateAveArrEve(timeData);\n//    for(var eveKey in eveList){\n//        if(eveList.hasOwnProperty(eveKey)){\n//            var average = min2HHMM(getAverage(eveList[eveKey]));\n//            var row = $(\n//                '<tr class=\"ave-digit\">'+\n//                    '<td class=\"range-title\" rowspan=\"2\">'+ eveKey +'</td>'+\n//                    '<td class=\"ave-digit-td no-wrap centering\" colspan=\"4\">'+ average +'</td>'+\n//                '</tr>'+\n//                '<tr class=\"caption\">'+\n//                     '<td class=\"no-wrap centering\" colspan=\"4\">先週より+2h15min</td>'+\n//                '</tr>');\n//\n//            var space0 = space.clone(true);\n//            var space1 = space.clone(true);\n//            if(count %2 === 1){\n//                space0.addClass(\"back-orange\");\n//                space1.addClass(\"back-orange\");\n//                row.addClass(\"back-orange\");\n//            }\n//\n//            tbody.append(space0)\n//                .append(row)\n//                .append(space1);\n//\n//            count++;\n//        }\n//    }\n//\n//    //データが皆無であればその旨を表示\n//     var tableOhters = $('#table-others');\n//     if(count === 0){\n//         errNonData.css('display', \"block\");\n//         tableOhters.css('display', \"none\");\n//     } else {\n//         errNonData.css('display', \"none\");\n//         tableOhters.css('display', \"block\");\n//     }\n//\n// }\n\n// function generateAveArr(timeData) {\n//     var ranges = {};\n//     for(var key in timeData){\n//         if(timeData.hasOwnProperty(key)){\n//             timeData[key][\"rangeList\"].forEach(function (range) {\n//                 var name = range.start.name + '  <i class=\"fas fa-angle-double-right color-orange\"></i>  ' + range.end.name;\n//                 if(!ranges.hasOwnProperty(name)){\n//                     ranges[name] = {};\n//                     ranges[name].start = [];\n//                     ranges[name].end = [];\n//                 }\n//                 var startTime = range.start.cal.hourOfDay *60 + range.start.cal.minute + range.end.offset *24*60;\n//                 var endTime = range.end.cal.hourOfDay *60 + range.end.cal.minute + range.end.offset *24*60;\n//                 ranges[name].start.push(startTime);\n//                 ranges[name].end.push(endTime);\n//             });\n//         }\n//     }\n//     return ranges;\n// }\n//\n// function generateAveArrEve(timeData) {\n//     var eves = {};\n//     for(var key in timeData){\n//         if(timeData.hasOwnProperty(key)){\n//             timeData[key][\"eventList\"].forEach(function (event) {\n//                 if(!eves.hasOwnProperty(event.name)){\n//                     eves[event.name] = [];\n//                 }\n//                 eves[event.name].push(event.cal.hourOfDay *60 + event.cal.minute);\n//             });\n//         }\n//     }\n//     return eves;\n// }\n//\n// function getAverage(arr) {\n//     var sum = 0;\n//     arr.forEach(function (time) {\n//         sum += time;\n//     });\n//     if(sum){\n//         var aveStart = sum / (arr.length);\n//         sum = Math.round(aveStart);\n//     }\n//     return sum;\n// }\n\nfunction roundWithDigit(num, digit) {\n    return Math.round(num*digit)/digit;\n}\n\n// function min2HHMM(min) {\n//     var m = moment();\n//     m.minute(min);\n//     return m.format('HH:mm');\n// }\n\nfunction generateTableBorder(className) {\n    const td = ($('<td>', {\n        class: className,\n        colspan: 8\n    }));\n    return $('<tr>').append(td);\n}\n\n/*-----------------------tabLayout2--------------------------*/\nfunction initTabLayout2() {\n    const bgColumns = [];\n    const smColumns = {};\n    $('<td>', {rowspan: 2}).html('日にち')\n        .appendTo(bgParam);\n    for(let key in masterJson){\n        if(masterJson.hasOwnProperty(key) && masterJson[key]){\n            masterJson[key].forEach(function (data) {\n                switch (data.dataType){\n                    case 2:\n                        // addBgColumn(bgColumns, bgParam, data);\n                        // addSmColumn(smColumns, smParam, data, 0);\n                        addNormalColumn(bgColumns, bgParam, data);\n                        break;\n                    case 3:\n                        addBgColumn(bgColumns, bgParam, data);\n                        addSmColumn(smColumns, smParam, data, 1);\n                        break;\n                    case 4:\n                        addNormalColumn(bgColumns, bgParam, data);\n                        break;\n                }\n            });\n        }\n    }\n\n    fixBgColumnSpan(bgParam, smColumns);\n\n    addRowsToTable(smParam, bgParam, bgColumns, smColumns);\n}\n\n/*----------------thead系--------------*/\nfunction addNormalColumn(bgColumns, bgParam, data) {\n    if(bgColumns.indexOf(data.dataName) === -1){\n        $('<td>', {\n            rowspan: 2\n        }).html(data.dataName)\n            .appendTo(bgParam);\n        bgColumns.push(data.dataName);\n    }\n}\n\nfunction addBgColumn(bgColumns, bgParam, data) {\n    if(bgColumns.indexOf(data.dataName) === -1){\n        $('<td>').html(data.dataName)\n            .appendTo(bgParam);\n        bgColumns.push(data.dataName);\n    }\n}\n\nfunction addSmColumn(smColumns, smParam, data, valuePos) {\n    data.data.forEach(function (value) {\n        const html = value.split(DELIMITER)[valuePos];\n        if(!smColumns[data.dataName]){\n            smColumns[data.dataName] = [];\n        }\n        if(smColumns[data.dataName].indexOf(html) === -1){\n            $('<td>').html(html)\n                .appendTo(smParam);\n            if(smColumns)\n                smColumns[data.dataName].push(html);\n        }\n    });\n}\n\nfunction fixBgColumnSpan(bgParam, smColumns) {\n    for(let key in smColumns){\n        if(smColumns.hasOwnProperty(key)){\n            bgParam.find(\"td:contains(\"+ key +\")\").attr('colspan', smColumns[key].length);\n        }\n    }\n}\n\n/*----------------------tbody系-----------------------*/\nfunction addRowsToTable(smParam, bgParam, bgColumns, smColumns) {\n\n    const smVals = Object.values(smColumns);\n    const tbody = $('#table-others').find('tbody');\n    let totalLen = 0;\n    const smColumnVals = Object.values(smColumns);\n    const smColumnKeys = Object.keys(smColumns);\n    smColumnVals.forEach(function (arr) {\n        totalLen += arr.length;\n    });\n    const len = bgColumns.length + totalLen - smColumnVals.length + 1;//+1は日付の分\n\n    const masterKeys = Object.keys(masterJson);\n    for(let k=0; k<masterKeys.length; k++){\n\n        const tr = $('<tr>');\n        if(k%2){\n            tr.css('background-color', \"#f9f9f7\");\n        }\n\n        for (let i = 0; i<len; i++) {\n            var td = $('<td>');\n            tr.append(td);\n            if(i === 0){\n                td.addClass('row-head');\n            }\n        }\n        const cal = moment(masterKeys[k], \"YYYYMMDD\");\n        const date = cal.date();\n        const title = date + \"日(\" + wodList[cal.day()] + \")\";\n        const rowHead = tr.find('td').eq(0);\n        rowHead.html(title);\n        //日曜日であれば赤色に\n        if(cal.day() === 0){\n            rowHead.addClass('holiday');\n        }\n\n        //休日であれば赤色にしてtippy表示\n        const holidayKey = cal.format(\"YYYY-MM-DD\");\n        const holidayPos = Object.keys(HOLIDAYS).indexOf(holidayKey);\n        if(holidayPos !== -1){\n            rowHead.attr('title',   HOLIDAYS[holidayKey]);\n            rowHead.addClass('holiday');\n        }\n\n\n        if(masterJson[masterKeys[k]]){\n            masterJson[masterKeys[k]].forEach(function (data) {\n                if(!data.data || data.dataType === 0 || data.dataType === 1)\n                    return;\n\n                let count = bgColumns.indexOf(data.dataName);\n                const keyLen = smColumnKeys.indexOf(data.dataName);\n                count -= keyLen;\n                for(let n=0; n<keyLen; n++){\n                    count += smColumnVals[n].length;\n                }\n                // count++;//日付カラムの分\n                // console.log(data.dataName + \"は\" + count + \"の並びにあります\");\n\n                switch (data.dataType) {\n                    case 2:\n                        const td0 = tr.find('td').eq(count);\n                        const titleVal = data.dataName + \" \" + title;\n                        setTagInCell(td0, data, titleVal);\n                        break;\n                    case 3:\n                        for(let m=0; m<data.data.length; m++){\n                            const pos = count + m + 1;\n                            const vals = data.data[m].split(DELIMITER);\n                            const tdE = tr.find('td').eq(pos);\n                            const titleValE = data.dataName + \" : \" + vals[1] + \" \" + title;\n                            if(vals[0] === \"0\"){\n                                const span = $('<span>', {\n                                    title: titleValE\n                                });\n                                if(vals[2] === \"true\"){\n                                    span.html('<i class=\"fas fa-check color-orange\"></i>').appendTo(tdE);\n                                } else if(vals[2] === \"false\"){\n                                    span.html('<i class=\"fas fa-times color-disable\"></i>').appendTo(tdE);\n                                }\n                            } else if(vals[0] === \"1\"){\n                                $('<span>', {\n                                    title: titleValE\n                                }).html(vals[2]).appendTo(tdE);\n                            }\n                        }\n                        break;\n                    case 4:\n                        // todo 本来は\"comment\"ノードに格納されているので、実装後この点を修正すること\n                        const td = tr.find('td').eq(count);\n                        if(data.data.length > 100) {\n                            // todo ここら辺の改行とかの動作、もうちょっとうまくやれるはず\n                            let value = null;\n                            if(data.data.indexOf(\"\\n\") === data.data.lastIndexOf(\"\\n\")){\n                                //改行が2箇所以上ある場合\n                                value = data.data.substring(0, 80) + \"...\";\n                            } else {\n                                const first = data.data.indexOf(\"\\n\");\n                                const second = data.data.substring(first).indexOf(\"\\n\");\n                                value = data.data.substring(0, second);\n                            }\n                            value = value.replace(/(?:\\r\\n|\\r|\\n)/g, '<br />');\n                            td.attr(\"full-txt\", data.data);\n                            td.html(value);\n                            const dropDownBtn = $('<i>', {\n                                class: \"fas fa-caret-down fa-lg color-orange\",\n                                onclick: \"expandText(this)\",\n                                title: data.dataName + \" \" + title\n                            });\n                            td.append($('<br />')).append(dropDownBtn);\n                        } else {\n                            td.html(data.data);\n                        }\n                        break;\n                }\n            });\n        }\n\n        tbody.append(tr);\n    }\n\n    setElementAsMdl(tbody);\n\n    tippy('[title]', {\n        updateDuration: 0,\n        popperOptions: {\n            modifiers: {\n                preventOverflow: {\n                    enabled: false\n                }\n            }\n        }\n    });\n}\n\nfunction setTagInCell(td, data, title) {\n    for(let m=0; m<data.data.length; m++){\n        const vals = data.data[m].split(DELIMITER);\n        if(vals[2] === \"true\")\n            continue;\n\n        const color = highlightColors[parseInt(vals[1])];\n        const chipsHtml = $(\n            '<span class=\"mdl-chip mdl-pre-upgrade\" style=\"background-color: ' + color + '\" title=\"' + title + '\">' +\n            '<span class=\"mdl-chip__text\">' + vals[0] + '</span>' +\n            '</span>');\n        td.append(chipsHtml);\n    }\n}\n\n//todo アニメーションつけられると尚良し\nfunction expandText(ele) {\n    console.log(\"expandText called\");\n    const td = $(ele).closest('td');\n    let txt = td.attr(\"full-txt\");\n    txt = txt.replace(/(?:\\r\\n|\\r|\\n)/g, '<br />');\n    td.html(txt);\n}\n\nfunction setElementAsMdl(clone) {\n    const ele = clone.find(\".mdl-pre-upgrade\");\n    for (let i=0; i<ele.length; i++){\n        componentHandler.upgradeElement(ele.eq(i)[0]);\n    }\n}"]}